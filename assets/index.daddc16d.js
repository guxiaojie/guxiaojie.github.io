import{a as I,o as c,c as A,u as U,R as B,b as l,d as i,t as d,F as k,r as T,e as w,w as b,_ as v,m as _,f as P,g as p,h as E,v as M,i as R,j as z,n as F,k as W,l as O,p as N,q as J,s as j,x as D,y as G,z as H,V as K,A as Z,B as Q}from"./vendor.b03fb755.js";const X=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}};X();let V="";V="https://www.storiesmatter.cn";class y{constructor(e){this.storyId=1,this.config=e,this.config.baseURL=V+"/api",this.token()}token(){const e="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjQ5MDc0MTEzLCJqdGkiOiJkZjI0MWY3NGUzMDA0NWQ5ODEyZTViZWQzYTk5NWIwYiIsInVzZXJfaWQiOjF9.BMA9VKU8ewI6V9Sr9DRTkZ3s3eJHQvSG72GvqhL-brA";this.axios=I.create({baseURL:this.config.baseURL}),this.axios.defaults.headers.common.Authorization=e}async roles(){const e=await this.axios.get(`topics/${this.storyId}/roles/`);return console.log("response",e),e.data}async home(){const e=await this.axios.get(`topics/${this.storyId}/home/`);return console.log("response",e),e.data}async fragments(e){const t=await this.axios.get(`fragments/${e}/`);return console.log("response",t),t.data}async home(){const e=await this.axios.get(`topics/${this.storyId}/home/`);return console.log("response",e),e.data}async search(e){try{const t=await this.axios.get(`topics/${this.storyId}/fragments/?q=${e}`);return console.log("response",t),t.data}catch(t){return console.log("response mserrorerrorg",t),null}}async unlock(e){const t=await this.axios.post(`topics/${this.storyId}/fragments/${e}/unlock/`);return console.log("response",t),t.data}async pricing(){const e=await this.axios.get(`topics/${this.storyId}/pricing/`);return console.log("response",e),e.data}async login(){const e={avatar_url:"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6pjAcqAwjE9l9Yc8bex4lrJ2PFE9rnJXvM0oSicxW8liadwT46J3pOMdHJ1scGR2jHiaEnVHWqcdYMA/132",city:"",country:"",gender:0,js_code:"091gvxGa1ypdMC0tOrJa1cOmJQ1gvxG3",language:"zh_CN",nick_name:"\u8C37\u6653\u6D01Sage",province:""},t=[],o="";if(o.length>0)for(const h of o)t.push(h.route);const n="",a={method:"POST",url:this.config.baseURL+"/simple-wechat-login/",headers:{Authorization:n,"Content-Type":"application/json"},data:e};return console.log("------options",a),(await I(a)).data}handleAxiosError(e){console.log("response err",e),console.log("response err",e.msg)}handleUnexpectedError(e){this.handleAxiosError(e)}async orders(e){try{const{data:t,statusCode:o,msg:n}=await this.axios.post(`topics/${this.storyId}/orders/`,{pricing_id:e});return console.log("response data",t),t}catch(t){console.log("response mserrorerrorg",t),I.isAxiosError(t)?this.handleAxiosError(t):this.handleUnexpectedError(t)}}}const Y={computed:{username(){return this.$route.params.username}},mounted(){this.goToDashboard()},methods:{goToDashboard(){this.$router.push("/home")}}},ee=Object.assign(Y,{setup(s){return(e,t)=>(c(),A(U(B)))}}),te="modulepreload",q={},se="/present-vue/",ie=function(e,t){return!t||t.length===0?e():Promise.all(t.map(o=>{if(o=`${se}${o}`,o in q)return;q[o]=!0;const n=o.endsWith(".css"),a=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${a}`))return;const r=document.createElement("link");if(r.rel=n?"stylesheet":te,n||(r.as="script",r.crossOrigin=""),r.href=o,document.head.appendChild(r),n)return new Promise((h,f)=>{r.addEventListener("load",h),r.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())},oe=async(s,e,t,o={},n)=>{if(o.cacheKey){const h=ne();if(h)return h}const a=[],r="";if(r.length>0)for(const h of r)a.push(h.route)},ne=s=>{const e="";return(new Date().getTime()-Number.parseInt(e.createTime))/1e3>86400?!1:e.value};var m={doRequest:oe};const ae=2;let $="";$="https://www.storiesmatter.cn";var g={host:$,url:$+"/api",check_openid:$+"/api/check_openid",env:ae,mapKey:""};const re=async(s,e,t={})=>await m.doRequest(`${g.url}/${s}`,"GET",e,t),ce=async(s,e,t={})=>await m.doRequest(`${g.url}/${s}`,"PUT",e,t),le=async(s,e,t={})=>await m.doRequest(`${g.url}/${s}`,"Post",e,t),de=async(s,e,t={})=>await m.doRequest(`${g.url}/${s}`,"DELETE",e,t),he=async(s,e={})=>await m.wxUpload(`${g.url}/upload`,s,e),ue=(s,e,t={},o)=>m.doRequest(`${g.url}/${s}`,"GET",e,t,o),pe=(s,e,t={},o)=>m.doRequest(`${g.url}/${s}`,"Post",e,t,o),me=(s,e,t={},o)=>m.doRequest(s,"GET",e,t,o),_e=(s,e,t={},o)=>m.doRequest(s,"Post",e,t,o),ge=(s,e,t)=>{wx.request({url:`${g.host}/${s}`,success:o=>t(o)})};var L={Get:re,Put:ce,Post:le,Destroy:de,PostBasic:pe,GetBasic:ue,WX:ge,Upload:he,GetWeixintBasic:me,PostWeixintBasic:_e};const fe={category:{statementExpendList:"@category_statement_expend@",statementIncomeList:"@category_statement_income@",expendList:"@category_expend_list@",incomeList:"@category_income_list@"},asset:{statementAssets:"@asset_statement@",list:"@asset_list@"},alreadyLogin:"@alreadyLogin@",login:"weapp_login_session",bgImageKey:"@user_index_bg@",errorKey:"@request_error@",localStatementKey:"@local_statement_cache@"};var S={key:fe,get:function(s){return null},set:function(s,e){}};class u{constructor(e){this.isLoading=!1,this.that=e.that}static form(e){return{message:e,type:"info",duration:1e3,dismissible:!1,queue:!1,position:"top"}}static success(e,t=500){if(setTimeout(()=>{wx.showToast({title:e,icon:"success",mask:!0,duration:t})},300),t>0)return new Promise((o,n)=>{setTimeout(()=>{o()},t)})}static confirm(e,t={},o="\u63D0\u793A"){return new Promise((n,a)=>{wx.showModal({title:o,content:e,showCancel:!0,success:r=>{r.confirm?n(t):r.cancel&&a(t)},fail:r=>{a(t)}})})}static toast(e,t="success"){const o={message:e,type:"info",duration:1e3,dismissible:!0,queue:!1,position:"top"};that.$toast.open(o)}static alert(e){wx.showToast({title:e,icon:"/public/images/error.png",mask:!0,duration:1500})}static error(e,t=1500){wx.showToast({title:e,icon:"none",mask:!1,duration:t})}static loading(e,t){if(u.isLoading)return;u.isLoading=!0;const o={message:"\u52A0\u8F7D\u4E2D...",type:"info",duration:1e4,dismissible:!1,queue:!1,position:"bottom-right",onClick:this.onClick,onDismiss:this.onDismiss};t.$toast.open(o)}static loaded(e){u.isLoading&&(u.isLoading=!1,e.$toast.clear())}static share(e,t,o){return{title:e,path:t,desc:o,success:function(n){u.toast("\u5206\u4EAB\u6210\u529F")}}}}u.isLoading=!1;var C=(s,e)=>{const t=s.__vccOpts||s;for(const[o,n]of e)t[o]=n;return t};const we={props:{statement:Object},methods:{statementEvent:function(s,e){console.log("----------",s,e),this.$emit("submit",s,e)}}},ve={class:"information"},ye={class:"icon"},xe=["src"],be={class:"st-title"},ke={class:"title"},$e={class:"time"};function Te(s,e,t,o,n,a){return c(),l("view",{class:"charactercell",onClick:e[0]||(e[0]=r=>a.statementEvent(t.statement.id))},[i("view",ve,[i("view",ye,[i("img",{src:t.statement.avatar},null,8,xe)]),i("view",be,[i("view",ke,d(t.statement.id)+":"+d(t.statement.name),1),i("view",$e,d(t.statement.brief_text),1)])])])}var Ce=C(we,[["render",Te]]);const Ie={class:"container"},Le=i("view",{style:{height:"20px"}},null,-1),Pe={class:"choose_character"},Se=i("view",{class:"column"},[i("text",{class:"title"},"\u9009\u62E9\u4F60\u7684\u8EAB\u4EFD")],-1),qe={class:"img-top-shortline"},Ee=["src"],We={class:"statement-list"},Ve={index:"index",item:"item"},Ae={class:"cell"},Ue=i("view",{style:{height:"30px"}},null,-1),Be={style:{width:"100%",height:"120px",display:"flex","justify-content":"center","align-items":"center"}},Me=i("text",{style:{"font-size":"40px",color:"white"}},"\u5F00\u59CB\u8C03\u67E5",-1),Re=[Me],ze=i("view",{class:"choose_character"},[i("view",{class:"column"},[i("text",{style:{"font-size":"24px",color:"#757575","margin-top":"-30px"}},"*\u63A2\u5458\u8EAB\u4EFD\u4E00\u65E6\u786E\u5B9A\uFF0C\u4E0D\u53EF\u66F4\u6539")])],-1),Fe=i("view",{style:{height:"50px"}},null,-1),Oe={components:{},data(){return{imgs:{shortline:"https://assets.storiesmatter.cn/shortline.png"},list:[{id:1,name:"b",text:"t",brief_text:"brief_text1"},{id:2,name:"c",brief_text:"brief_text2"},{id:3,name:"d",brief_text:"brief_text3"}]}},async mounted(){const e=await new y({}).roles();console.log("--",e),console.log("--",e.results),this.list=e.results},methods:{submit:function(s,e){console.log("---sumit in parent",s,e)},handleInquiry:function(){this.$router.push("/home")}}},Ne=Object.assign(Oe,{setup(s){return(e,t)=>(c(),l(k,null,[i("view",Ie,[Le,i("view",Pe,[Se,i("view",qe,[i("img",{src:e.imgs.shortline,mode:"widthFix"},null,8,Ee)])]),i("view",We,[(c(!0),l(k,null,T(e.list,o=>(c(),l("view",Ve,[i("view",Ae,[w(Ce,{statement:o,onSubmit:e.submit},null,8,["statement","onSubmit"])])]))),256))])]),Ue,i("view",Be,[i("view",{style:{width:"320px",height:"120px",display:"flex","justify-content":"center","align-items":"center"},class:"btn",onClick:t[0]||(t[0]=(...o)=>e.handleInquiry&&e.handleInquiry(...o))},Re)]),ze,Fe],64))}});const Je={class:"container"},je={key:0},De=["title"],Ge=i("text",null,[i("span",null,"\xA0\xA0\xA0 "),W(" \u5BA2\u670D\u5FAE\u4FE1\u8BF7\u6DFB\u52A015711067100")],-1),He=i("text",{class:"copy"},[W("\u4E00\u952E\u590D\u5236\u8D26\u53F7 "),i("span",null,"\xA0\xA0\xA0 ")],-1),Ke=[Ge,He],Ze={style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},Qe=i("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[i("view",null,"\u641C\u7D22\u6B21\u6570\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u89E3\u9501\u8BB0\u5FC6\u788E\u7247")],-1),Xe=i("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[i("view",null,"\u641C\u7D22\u6B21\u6570\u5DF2\u7ECF\u7528\u5B8C\uFF0C\u8BF7\u5148\u5145\u503C\uFF01")],-1),Ye={class:"header"},et={class:"level-1"},tt={key:0,class:"top-btns"},st={class:"column1"},it={class:"btn1"},ot={class:"btn1"},nt={class:"btn1"},at={key:1,class:"dotline"},rt=["src"],ct={key:2,class:"userinfo"},lt={class:"icon"},dt=["src"],ht={class:"st-title"},ut={class:"first-line"},pt={class:"time"},mt={key:3,class:"dotline"},_t=["src"],gt={key:1,class:"searchcell",id:"searchit"},ft=i("view",{class:"recordcell"},[i("view",{class:"title1"},[i("text",{class:"btn1"},"\u8C03\u67E5\u8BB0\u5F55")])],-1),wt={class:"searchbar"},vt={class:"search"},yt={class:"search-block",action:"javascript:void 0"},xt={class:"search-btn"},bt=["src"],kt={class:"paycell"},$t={class:"paycell-title"},Tt={class:"btn1"},Ct=["src"],It={class:"btn1"},Lt={class:"longline"},Pt=["src"],St={class:"fragment-content",id:"fragmentContent","wx:key":"index"},qt={class:"fragment-title"},Et={class:"container-box"},Wt=["id"],Vt={key:0},At=["onClick"],Ut={key:1},Bt=["onClick"],Mt={class:"longline"},Rt=["src"],zt=i("view",{style:{height:"60px"}},null,-1),Ft={data(){return{book:"\u6545\u610F\u4E8B\u52A1\u6240\u63A2\u5458\u7CFB\u7EDF",payTitle:"\u8D2D\u4E70\u6B21\u6570",emptyTitle:"",role_stats:[],top_links:[{id:1,link_order:1,link_url:"https://www.storiesmatter.cn/test",title:"TEST1"},{id:2,link_order:1,link_url:"https://www.storiesmatter.cn/test",title:"TEST1"},{id:3,link_order:1,link_url:"https://www.storiesmatter.cn/test",title:"TEST1"}],my_role:{id:"4",name:"",crew:"",icon_path:"",avatar:""},buttons:[{title:"\u89C4\u5219\u73A9\u6CD5",src:"http://mp.weixin.qq.com/s?__biz=MzIwNTg1NzU0NA==&mid=100005155&idx=1&sn=29b13f3fdfcaed03d202a1f897ef7639&chksm=172b2344205caa523efa40e1da70ac1643a605de2c5a1b6cdefebf5d9a511f9cb97849b2a97c#rd"},{title:"\u7EBF\u7D22\u8109\u7EDC",src:"http://mp.weixin.qq.com/s?__biz=MzIwNTg1NzU0NA==&mid=100005204&idx=1&sn=734fd67be72420de1a1aa575f3a780ab&chksm=172b2333205caa25d894c68bd564507325ac57d99f14c47eae01bb7084cb6cc13a28007428bd#rd"},{title:"\u63D0\u4EA4\u62A5\u544A",src:"http://mp.weixin.qq.com/s?__biz=MzIwNTg1NzU0NA==&mid=100005201&idx=1&sn=83556cc41002cfd3ecbcfee2681b63ec&chksm=172b2336205caa20f3abeaa662fb6367cc0ba2a3e45b361b4db042e2cd3b703311f10fc8ea3f#rd"},{title:"\u59D4\u6258\u4FE1\u606F",src:"https://mp.weixin.qq.com/s?__biz=MzIwNTg1NzU0NA==&mid=100005152&idx=1&sn=95fb303f7cd5ba55819bb935785b8aea&chksm=172b2347205caa5175ddd120c217028a9c680da0067316d4cf3dbd559b26101f9979432b1f88#rd"}],remain_credit:0,userInfo:!0,dataLoaded:!1,currentTotal:"",submiting:!1,inputValue:"",showAuthorise:!1,isAuthorised:!1,characterId:0,focusSearchInput:!1,justFound:-1,searchScrollTop:286,searching:!1,visible1:!1,isUnlocakModalVisible:!1,gotoTopupVisible:!1,gotoTopupVisible2:!1,isIntroVisible:!1,unlockCredit:0,unlockFragmentId:0,animate:[],windowHeight:750,discoveredList:[],onboard:!1,inWechatBrowser:!1,imageSize:{},px2rpx:2,windowWidth:375,count:1,imgs:{help:"https://assets.storiesmatter.cn/help.png?1",eye:"https://assets.storiesmatter.cn/eye-top.png?2",tick:"https://assets.storiesmatter.cn/tick.png?1",crew:"https://assets.storiesmatter.cn/icon-crew.png",hospital:"https://assets.storiesmatter.cn/icon-hospital.png",delegate:"https://assets.storiesmatter.cn/icon-delegate.png",dot:"https://assets.storiesmatter.cn/dotline.png",search:"https://assets.storiesmatter.cn/search-button.png",pay:"https://assets.storiesmatter.cn/icon-pay.png",line:"https://assets.storiesmatter.cn/longline.png",intromodal:"https://assets.storiesmatter.cn/intromodal.png"},api:null,spinning:!1}},computed:{username(){return this.$route.params.username}},async mounted(){this.api=new y({});const s=await this.api.home();if(!v.isEmpty(s)){this.updateUI(s),this.discoveredList=[];for(var e=0;e<s.role_stats.length;e++){let n=s.role_stats[e];for(var t=0;t<n.fragments.length;t++){let a=n.fragments[t];a.has_discovered==!0&&this.discoveredList.push(a.id)}}}var o=window.navigator.userAgent.toLowerCase();o.match(/MicroMessenger/i)=="micromessenger"?this.inWechatBrowser=!0:this.inWechatBrowser=!1,this.inWechatBrowser=!0},methods:{handlePieceTap:function(s){let e=this.discoveredList.indexOf(s);e!=null&&(console.log("--- this.discoveredList",this.discoveredList),this.$router.push({path:"/piece",query:{id:s,index:e,discoveredList:this.discoveredList}}))},handleUnlockedPieceTap:function(s,e){console.log("---fragmentId",s,e),this.unlockFragmentId=s,this.isUnlocakModalVisible=!0,this.unlockCredit=e},onClick:function(){this.requestUnlockedPiece()},onDismiss:function(){this.$toast.clear()},creditZero:function(){this.inWechatBrowser?this.gotoTopupVisible2=!0:_.warning("\u641C\u7D22\u6B21\u6570\u5DF2\u7528\u5B8C\uFF0C\u8BF7\u5148\u8054\u7CFB\u5BA2\u670D\u54E6\uFF01")},async requestUnlockedPiece(){this.spinning=!0;const s=await this.api.unlock(this.unlockFragmentId);this.spinning=!1,s!=null?s.code=="e190"||s.code=="e120"?this.inWechatBrowser?this.gotoTopupVisible=!0:this.copy():s.code==null&&(this.justFound=s.id,this.getChanllengeList()):_.error("\u89E3\u9501\u8BB0\u5FC6\u788E\u7247\u5931\u8D25")},handleGotoTopup:function(){this.gotoTopupVisible=!1,this.$router.push({path:"/topup"})},handleCancelTopup:function(){this.gotoTopupVisible=!1,this.gotoTopupVisible2=!1},async requestSearch(){if(console.log("---requestSearch",this.inputValue,this.remain_credit),this.remain_credit<=0){this.creditZero();return}if(this.inputValue.length==0){_.warning("\u8BF7\u8F93\u5165\u5173\u952E\u8BCD");return}if(this.inputValue.length>7){_.warning("\u5173\u952E\u8BCD\u6700\u957F\u4E0D\u8D85\u8FC77\u4E2A\u5B57");return}var s=new RegExp("[\u4E00-\u9FA5A-Za-z0-9]+$","g");if(!s.test(this.inputValue)){_.warning("\u5173\u952E\u8BCD\u90FD\u4E0D\u542B\u6807\u70B9\u54E6");return}if(this.searching==!0)return;this.searching=!0,this.spinning=!0;const e={code:"e130"};if(this.spinning=!1,this.searching=!1,!v.isEmpty(e))if(v.isEmpty(e.code))this.justFound=e.id,this.getChanllengeList();else{this.focusSearchInput=!0,this.focusSearchInput=!1;let t=null;if(e.code=="e120")this.creditZero(),this.focusSearchInput=!1;else if(e.code=="e110")t="\u8BA2\u5355\u4E0D\u5B58\u5728";else if(e.code=="e100")t="\u6E38\u620F\u4E3B\u9898\u4E0D\u5B58\u5728";else if(e.code=="e130"){t="\u6C92\u627E\u5230\u76F8\u5173\u788E\u7247\uFF0C\u8BF7\u91CD\u65B0\u641C\u7D22";let o=S.get("searchedCount");o==null&&(o=0),o++,o>=5&&(t="\u5361\u4F4F\u4E86\uFF1F\u8054\u7CFB\u5BA2\u670D\u8981\u4E2A\u63D0\u793A\u5427\uFF01")}t&&_.warning(t),this.remain_credit==0||(this.remain_credit=this.remain_credit-1)}this.inputValue=""},updateUI:function(s){this.my_role.name=s.my_role.name,this.my_role.avatar=s.my_role.avatar;let e=s.other_roles,t="";for(var o=e.length-1;o>=0;o--)t=t+e[o].name+(o==0?"":"\uFF0C");this.my_role.crew=t,this.role_stats=s.role_stats,this.remain_credit=s.remain_credit,this.dataLoaded=!0,this.isAuthorised=!0,this.justFound>0&&(_.warning("\u6210\u529F\u627E\u5230\u788E\u7247"),this.justFound=-1)},handleHelp:function(s){},handleTopup:function(s){this.$router.push({path:"/topup"})},copy:function(s){this.$copyText("15711067100").then(function(e){alert("Copied"),console.log(e)},function(e){alert("Can not copy"),console.log(e)})},handleOk:function(){this.visible1=!1},handleCancel:function(){this.visible1=!0},handleUnlockOk(){this.isUnlocakModalVisible=!1,this.requestUnlockedPiece()},handleUnlockCancel(){this.isUnlocakModalVisible=!1},async getChanllengeList(){const s=await this.api.home();if(!v.isEmpty(s)){this.updateUI(s),this.discoveredList=[];for(var e=0;e<s.role_stats.length;e++){let o=s.role_stats[e];for(var t=0;t<o.fragments.length;t++){let n=o.fragments[t];n.has_discovered==!0&&this.discoveredList.push(n.id)}}}}}},Ot=Object.assign(Ft,{setup(s){return(e,t)=>{const o=P("a-modal"),n=P("a-spin");return c(),l("view",Je,[w(n,{spinning:e.spinning},{default:b(()=>[e.isAuthorised?p("",!0):(c(),l("view",je,[i("text",{title:e.emptyTitle},null,8,De)])),i("view",{class:"systemprompt",onClick:t[0]||(t[0]=(...a)=>e.copy&&e.copy(...a))},Ke),w(o,{title:"",visible:e.isUnlocakModalVisible,onOk:e.handleUnlockOk,onCancel:e.handleUnlockCancel,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u89E3\u9501",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:b(()=>[i("view",Ze,[i("view",null,"\u8BE5\u8BB0\u5FC6\u788E\u7247\u5C1A\u672A\u89E3\u9501\uFF0C\u8981\u6D88\u8017"+d(e.unlockCredit)+"\u6B21\u641C\u7D22\u673A\u4F1A\u89E3\u9501\u5417\uFF1F",1)])]),_:1},8,["visible","onOk","onCancel"]),w(o,{title:"",visible:e.gotoTopupVisible,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:b(()=>[Qe]),_:1},8,["visible","onOk","onCancel"]),w(o,{title:"",visible:e.gotoTopupVisible2,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:b(()=>[Xe]),_:1},8,["visible","onOk","onCancel"]),i("view",Ye,[i("view",et,[i("text",null,d(e.book),1)]),e.dataLoaded?(c(),l("view",tt,[i("view",st,[i("view",{class:"btns",onClick:t[1]||(t[1]=a=>e.handleHelp(0))},[i("text",it,d(e.top_links[0].title),1)]),i("view",{class:"btns",onClick:t[2]||(t[2]=a=>e.handleHelp(1))},[i("text",ot,d(e.top_links[1].title),1)]),i("view",{class:"btns",onClick:t[3]||(t[3]=a=>e.handleHelp(2))},[i("text",nt,d(e.top_links[2].title),1)])])])):p("",!0),e.dataLoaded?(c(),l("view",at,[i("img",{src:e.imgs.dot},null,8,rt)])):p("",!0),e.dataLoaded?(c(),l("view",ct,[i("view",lt,[i("img",{src:e.my_role.avatar},null,8,dt)]),i("view",ht,[i("view",ut,"\u63A2\u5458\uFF1A"+d(e.my_role.name),1),i("view",pt,"\u7EC4\u5458\uFF1A"+d(e.my_role.crew),1)])])):p("",!0),e.dataLoaded?(c(),l("view",mt,[i("img",{src:e.imgs.dot},null,8,_t)])):p("",!0)]),e.dataLoaded?(c(),l("view",gt,[ft,i("view",wt,[i("view",vt,[i("form",yt,[E(i("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u4F60\u60F3\u8981\u7684\u5185\u5BB9","onUpdate:modelValue":t[4]||(t[4]=a=>R(inputValue)?inputValue.value=a:null),onKeyup:t[5]||(t[5]=z((...a)=>e.requestSearch&&e.requestSearch(...a),["13"]))},null,544),[[M,e.inputValue]])])]),i("view",xt,[i("img",{src:e.imgs.search,onClick:t[6]||(t[6]=a=>e.requestSearch())},null,8,bt)])]),i("view",kt,[i("view",$t,[i("text",Tt,"\u641C\u7D22\u5269\u4F59\u6B21\u6570\uFF1A"+d(e.remain_credit),1)]),i("view",{class:"topup",onClick:t[7]||(t[7]=(...a)=>e.handleTopup&&e.handleTopup(...a))},[i("img",{src:e.imgs.pay},null,8,Ct),i("text",It,d(e.payTitle),1)])]),i("view",Lt,[i("img",{src:e.imgs.line,mode:"widthFix"},null,8,Pt)])])):p("",!0),(c(!0),l(k,null,T(e.role_stats,a=>(c(),l("view",St,[i("view",qt,[i("text",null,d(a.role),1)]),i("view",Et,[(c(!0),l(k,null,T(a.fragments,r=>(c(),l("view",{class:F(r.has_discovered?"item-box discovered":"item-box"),id:r.id},[r.has_discovered==!0?(c(),l("view",Vt,[i("text",{animation:"{{animate[item.id]}}",onClick:h=>e.handlePieceTap(r.id),"data-cid":"item.id"},d(r.display_label),9,At)])):(c(),l("view",Ut,[i("text",{onClick:h=>e.handleUnlockedPieceTap(r.id,r.credit_to_unlock)},d(r.display_label),9,Bt)]))],10,Wt))),256))]),i("view",Mt,[i("img",{src:e.imgs.line,mode:"widthFix"},null,8,Rt)])]))),256)),zt]),_:1},8,["spinning"])])}}});const Nt={data(){return{img:"https://assets.storiesmatter.cn/map.png",olddistance:"",newdistance:"",diffdistance:"",oldscaleA:1,Scale:1,baseHeight:"",baseWidth:"",width:"",height:"",px2rpx:2,windowWidth:375}}},Jt={class:"container"},jt=["src"];function Dt(s,e,t,o,n,a){const r=P("scroll-view");return c(),l("view",Jt,[w(r,{"scroll-y":"true","scroll-x":"true",class:"FilePath",bindtouchmove:"scroll",bindtouchstart:"scroll",bindtouchend:"endTou"},{default:b(()=>[i("img",{src:n.img,style:{width:"{{width}}rpx",height:"{{height}}rpx"},bindtouchmove:"touch",mode:"scaleToFill",bindload:"imageLoad"},null,8,jt)]),_:1})])}var Gt=C(Nt,[["render",Dt]]);const Ht={data(){return{search_text:"",content_type:1,display_id:"",role:"",comment:"",text:"",image:"",pictures:[""],imageSize:{},px2px:2,windowWidth:375,src:"",curTime:"00:00",endTime:"00:00",reCurTime:"",reEndTime:"",playurl:"",status:"",cdCls:"pause",currentDot:0,isplay:!1,timer:"",currentFragmentId:87,discoveredList:[],currentPieceIndex:0,last:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png",eye:"https://assets.storiesmatter.cn/eye.png",play:"https://assets.storiesmatter.cn/play1.png",pause:"https://assets.storiesmatter.cn/pause1.png"},imgWidth:375}},async mounted(){console.log("imgWidth",this.imgWidth),console.log(this.$route.query),this.imgWidth=(document.documentElement.clientWidth||document.body.clientWidth)-20,console.log("imgWidth",this.imgWidth),v.isEmpty(this.$route.query)||(this.discoveredList=this.$route.query.discoveredList,this.currentPieceIndex=this.$route.query.index),this.gotoPiece();const s="width=device-width, initial-scale=1.0, user-scalable=yes";document.querySelector('meta[name="viewport"]').content=s},methods:{gotoMap(){},async requestFragment(){this.$toast.open({message:"\u6B63\u5728\u52A0\u8F7D...",duration:2e3,dismissible:!1});const e=await new y({}).fragments(this.currentFragmentId);e!=null&&(this.search_text=e.search_text,this.content_type=e.content_type,this.role=e.role_name,this.display_id=e.display_id,this.comment=e.comment,this.text=e.text,this.playurl=e.audio,this.image=e.image,this.pictures.push(e.image),this.playurl!=null&&this.content_type==3),this.$toast.clear()},gotoPiece(){this.onUnloadAudio(),this.currentFragmentId=this.discoveredList[this.currentPieceIndex],parseInt(this.currentPieceIndex)+1==this.discoveredList.length?this.last=!0:this.last=!1,console.log("this.currentFragmentId",this.currentFragmentId),this.currentFragmentId!=null&&(this.pictures=[],this.imageSize=[],this.requestFragment())},previous(){this.currentPieceIndex<=0||(this.currentPieceIndex--,this.gotoPiece())},next(){parseInt(this.currentPieceIndex)+1>=this.discoveredList.length||(this.currentPieceIndex++,this.gotoPiece())},onUnloadAudio(){clearInterval(this.timer)},onUnload(){this.onUnloadAudio()}}},Kt={class:"container"},Zt=i("view",{style:{height:"40px"}},null,-1),Qt={class:"choose_character"},Xt={class:"column"},Yt=["src"],es=i("view",{style:{width:"10px"}},null,-1),ts={style:{"font-size":"18px"}},ss={class:"img-top-shortline"},is=["src"],os={class:"userinfobtns"},ns={class:"column"},as={class:"btn"},rs={class:"btn"},cs={class:"btn"},ls=["src"],ds={key:1,class:"sliderCont"},hs=["src"],us={key:2,class:"message"},ps=i("view",{style:{height:"100px"}},null,-1),ms={class:"bottom1"},_s={class:"column1"},gs={key:0},fs={key:1},ws=i("text",{decode:"{{true}}"},"\u4E0A\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),vs=[ws],ys={key:2},xs={key:3},bs=i("text",{decode:"{{true}}"},"\u4E0B\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),ks=[bs];function $s(s,e,t,o,n,a){return c(),l("view",Kt,[Zt,i("view",Qt,[i("view",Xt,[i("img",{style:{width:"30px",height:"15px","margin-top":"7px"},src:n.imgs.eye},null,8,Yt),es,i("text",ts,d(n.search_text),1)]),i("view",ss,[i("img",{src:n.imgs.shortLine,mode:"widthFix"},null,8,is)])]),i("view",os,[i("view",ns,[i("view",as,[i("text",null,d(n.display_id),1)]),i("view",rs,[i("text",null,d(n.role),1)]),i("view",cs,[i("text",null,d(n.comment),1)])])]),n.content_type==2?(c(),l("view",{key:0,class:"fragment-img",onClick:e[0]||(e[0]=(...r)=>a.gotoMap&&a.gotoMap(...r))},[i("view",null,[i("img",{src:n.pictures[0],style:O({width:n.imgWidth+"px"}),mode:"scaleToFill"},null,12,ls)])])):p("",!0),n.content_type==3?(c(),l("view",ds,[i("audio",{src:n.playurl,controls:"controls",class:"aaudio"},null,8,hs)])):p("",!0),n.content_type==1?(c(),l("text",us,d(n.text),1)):p("",!0),ps,i("view",ms,[i("view",_s,[n.currentPieceIndex==0?(c(),l("view",gs)):(c(),l("view",fs,[i("view",{class:"btn1",onClick:e[1]||(e[1]=(...r)=>a.previous&&a.previous(...r))},vs)])),n.last==!0?(c(),l("view",ys)):(c(),l("view",xs,[i("view",{class:"btn1",onClick:e[2]||(e[2]=(...r)=>a.next&&a.next(...r))},ks)]))])])])}var Ts=C(Ht,[["render",$s]]);const Cs={components:{},data(){return{pickedId:1,list:[],currentid:"1",position:"left",disabled:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png"},imageSize:{},px2rpx:2,windowWidth:375,videoAd:null,inWechatBrowser:!1}},onLoad(s){s.type!=null&&(this.type=s.type)},mounted(){var s=window.navigator.userAgent.toLowerCase();s.match(/MicroMessenger/i)=="micromessenger"?this.inWechatBrowser=!0:this.inWechatBrowser=!1,this.greet()},computed:{},methods:{greet:async function(s){u.loading(null,this);const t=await new y({}).pricing();t==null||(this.list=t.results,S.set("pricing",t.results)),u.loaded(this)},redirect_url(s){wx.navigateTo({url:`/pages/categories/child?id=${s}&type=${this.type}`})},handleFruitChange({detail:s={}}){this.current=s.value},handleRadio(s,e){console.log("index",s,e),this.currentid=e,this.pickedId=s+1},radioChange({detail:s={}}){this.currentid=s.value},async handlePay(){console.log("sssss"),u.loading(null,this),await new y({}).orders(1,1);const e=await L.Post("topics/1/orders/",{pricing_id:this.currentid});e==null||(console.log(e),e.status=="ok"&&wx.requestPayment({timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign,success:function(t){console.log("PAID!!"),wx.navigateBack({delta:1})},fail:function(t){console.log("\u652F\u4ED8\u5931\u6557")},complete:function(t){console.log("\u652F\u4ED8\u5B8C\u6210")}})),u.loaded()},async handlePay1(){if(console.log("handlePay1"),!this.inWechatBrowser){_.warning("\u8BF7\u5728\u5FAE\u4FE1\u91CC\u6253\u5F00\u5145\u503C\u9875\u9762\uFF0C\u6216\u8054\u7CFB\u5BA2\u670D\u54E6\uFF01");return}const s=this;typeof WeixinJSBridge=="undefined"?(console.log("WeixinJSBridge undefined"),document.addEventListener?(console.log("2"),document.addEventListener("WeixinJSBridgeReady",s.onBridgeReady,!1)):document.attachEvent&&(console.log("3"),document.attachEvent("WeixinJSBridgeReady",s.onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",s.onBridgeReady))):(console.log("WeixinJSBridge is defined"),this.onBridgeReady()),this.onBridgeReady()},onBridgeReady(){new y({}).orders(this.currentid).then(e=>{if(!v.isEmpty(e)&&e.status==="ok"){const{appId:t="wx1f692d7b9b57066d",timeStamp:o,nonceStr:n,paySign:a}=e,r="MD5",h=e.package;console.log("nonceStr",n),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t,timeStamp:o,nonceStr:n,package:h,signType:r,paySign:a},function(f){console.log("res",f),f.err_msg=="get_brand_wcpay_request:ok"?console.log("\u652F\u4ED8\u6210\u529F"):console.log("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8")})}})},imageLoad(s){const e=s.detail.width*this.px2rpx,t=s.detail.height*this.px2rpx,o=e/t;let n=750,a;e>=n?a=n/o:(n=e,a=t);const r=this.imageSize;r[s.target.dataset.index]={width:n,height:a},this.imageSize=r},gotoMap(){const s=this.pictures[0]+"?"+Math.random()/9999;wx.previewImage({current:s,urls:[s],success:function(e){},fail:function(e){},complete:function(e){}})},loadAds(){this.videoAd?this.videoAd.show().catch(()=>{this.videoAd.load().then(()=>{this.videoAd.show()}).catch(s=>{console.log("\u6FC0\u52B1\u89C6\u9891 \u5E7F\u544A\u663E\u793A\u5931\u8D25")})}):wx.showModal({title:"\u8B66\u544A",content:"\u53EF\u89C2\u770B\u6FC0\u52B1\u5F0F\u89C6\u9891\u5E7F\u544A\u7684\u6B21\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C \u8BF7\u7A0D\u540E\u91CD\u8BD5",showCancel:!1,success:function(s){}})}},async requestPricing(){u.loading("\u52A0\u8F7D\u4E2D...");const s=await L.Get("topics/1/pricing/");s==null||(this.list=s.results,S.set("pricing",s.results)),u.loaded()},async requestCredit(){const s=await L.Get("topics/1/ads-credit/");s!=null&&wx.showModal({title:"",content:s.added_credit+"\u6B21\u641C\u7D22\u6B21\u6570\u5DF2\u5230\u8D26",showCancel:!1,success:function(e){}})}},Is={class:"container"},Ls=i("view",{style:{height:"40px"}},null,-1),Ps={class:"choose_character"},Ss=i("view",{class:"column"},[i("text",{class:"title1"},"\u8D2D\u4E70\u641C\u7D22\u6B21\u6570")],-1),qs={class:"img-top-shortline"},Es=["src"],Ws={class:"statement-list"},Vs=["onClick"],As=["value"],Us={class:"cell-text"},Bs=i("p",null,null,-1),Ms=i("text",{class:"svg-demo-text"},"\u5FAE\u4FE1\u652F\u4ED8",-1),Rs=[Ms];function zs(s,e,t,o,n,a){return c(),l("view",Is,[Ls,i("view",Ps,[Ss,i("view",qs,[i("img",{src:n.imgs.shortLine,mode:"widthFix"},null,8,Es)])]),i("view",Ws,[(c(!0),l(k,null,T(n.list,(r,h)=>(c(),l("view",{key:h,index:"index",item:"item"},[i("view",{class:"cell",onClick:f=>a.handleRadio(h,r.id)},[E(i("input",{class:"cell-radio",type:"radio",value:r.id,"onUpdate:modelValue":e[0]||(e[0]=f=>n.pickedId=f)},null,8,As),[[N,n.pickedId]]),i("text",Us,d(r.credit)+"\u6B21\u641C\u7D22 \xA5"+d(r.price),1),Bs],8,Vs)]))),128))]),i("view",{class:"pay",onClick:e[1]||(e[1]=(...r)=>a.handlePay1&&a.handlePay1(...r))},Rs)])}var Fs=C(Cs,[["render",zs]]);const Os=J({history:j("/present-vue/"),routes:[{path:"/home",name:"home",component:Ot},{path:"/character",name:"character",component:Ne},{path:"/about",name:"about",component:()=>ie(()=>import("./AboutView.e32245f6.js"),["assets/AboutView.e32245f6.js","assets/AboutView.ab071ea6.css","assets/vendor.b03fb755.js"])},{path:"/piece",component:Ts},{path:"/map",component:Gt},{path:"/topup",component:Fs}]});const Ns=D({state(){return{count:0}},mutations:{increment(s){s.count++}},modules:{toast:G({dismissInterval:8e3})}}),x=H(ee);x.use(Os);x.use(Ns);x.use(K,{position:"top"});x.use(Z);x.use(Q);x.mount("#app");export{C as _};
