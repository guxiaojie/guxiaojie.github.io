import{_ as d,a as S,o as l,c as P,u as E,R as O,b as c,d as t,t as h,e as $,r as v,f,F as w,g as k,m as p,w as T,v as L,i as U,h as g,j as I,k as F,n as q,l as M,p as R,q as j,s as J,V as N,x as z,A as W}from"./vendor.dc04f490.js";const A=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}};A();let V="";V="https://www.storiesmatter.cn";class _{constructor(e){this.storyId=1,console.log("localStorage.storyId",localStorage.storyId),!d.isEmpty(localStorage.storyId)&&localStorage.storyId!=="null"&&(this.storyId=localStorage.storyId),this.config=e,this.config.baseURL=V+"/api",this.token()}token(){var e="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjQ5MDc0MTEzLCJqdGkiOiJkZjI0MWY3NGUzMDA0NWQ5ODEyZTViZWQzYTk5NWIwYiIsInVzZXJfaWQiOjF9.BMA9VKU8ewI6V9Sr9DRTkZ3s3eJHQvSG72GvqhL-brA";e="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjUwMTkzNDcxLCJqdGkiOiJlZmIzNzJkMjNlNjc0ZmUwOTY3MjEwZTEzZTFlM2VhMyIsInVzZXJfaWQiOjMwNTA3fQ.MPdrp4OxvtLjMu6mNss0ZPObHE3F-Eic1N5u6oStAF0",this.axios=S.create({baseURL:this.config.baseURL}),this.axios.defaults.headers.common.Authorization=e}async roles(){const e=await this.axios.get(`topics/${this.storyId}/roles/`);return console.log("roles response",e),e.data}async home(){try{const e=await this.axios.get(`topics/${this.storyId}/home/`);return console.log("response",e),e.data}catch(e){return console.log("home error: "+e+e.response.data),console.log(e.response.data),console.log("home error: ",e instanceof Error),e}}async initGame(e){try{const s=await this.axios.post(`topics/${this.storyId}/init-game/`,{role_id:e});return console.log("initGame response",s),s.data}catch(s){return console.log("initGame error: ",s),console.log("initGame error: ",s.response.data),s}}async fragments(e){const s=await this.axios.get(`fragments/${e}/`);return console.log("response",s),s.data}async search(e){try{const s=await this.axios.get(`topics/${this.storyId}/fragments/?q=${e}`);return console.log("response",s),s.data}catch(s){return console.log("response mserrorerrorg",s),null}}async unlock(e){const s=await this.axios.post(`topics/${this.storyId}/fragments/${e}/unlock/`);return console.log("response",s),s.data}async pricing(){const e=await this.axios.get(`topics/${this.storyId}/pricing/`);return console.log("response",e),e.data}async orders(e){const s=await this.axios.post(`topics/${this.storyId}/orders/`,{pricing_id:e});return console.log("response data",s),s}async openid(e){const i="https://api.weixin.qq.com/sns/oauth2/access_token?appid=wx4ca91a098674cef4&secret=d5446cbe1c3518f445405de758170f97&grant_type=authorization_code&code="+e,r=await this.axios.get(i);console.log("openid response",r)}async getCode(e){try{const s=await this.axios.post("phoneno-get-code/",{phone_no:e});return console.log("response",s),s.data}catch(s){return console.log("response mserrorerrorg",s),null}}async phonenoLogin(e,s){try{const n=await this.axios.post("phoneno-login/",{phone_no:e,user_input_code:s});return console.log("response",n),localStorage.token=d.get(n.data,"access"),localStorage.refresh=d.get(n.data,"refresh"),n.data}catch(n){console.log("response mserrorerrorg",n),console.log(n.response.data);const i=d.get(n.response.data,"non_field_errors"),r=d.get(n.response.data,"user_input_code");if(d.isEmpty(i)){if(!d.isEmpty(r))return n.message=r[0],n}else return n.message=i[0],n;return n}}async tokenVerify(){try{const e=await this.axios.post("token/verify/",{token:localStorage.token});return console.log("verify token response",e),!0}catch(e){if(console.log("response mserrorerrorg",e),d.isEmpty(localStorage.refresh))return!1;{const n=await new _({}).tokenRefresh();return console.log("tokenRefresh",n),n}}}async tokenRefresh(){try{const e=await this.axios.post("token/refresh/",{refresh:localStorage.refresh});return console.log("refresh response",e),d.isEmpty(e.data)?!1:(localStorage.token=d.get(e.data,"access"),!0)}catch(e){return console.log("tokenRefresh",e),!1}}async login(){const e={avatar_url:"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6pjAcqAwjE9l9Yc8bex4lrJ2PFE9rnJXvM0oSicxW8liadwT46J3pOMdHJ1scGR2jHiaEnVHWqcdYMA/132",city:"",country:"",gender:0,js_code:"091gvxGa1ypdMC0tOrJa1cOmJQ1gvxG3",language:"zh_CN",nick_name:"\u8C37\u6653\u6D01Sage",province:""},s=[],n="";if(n.length>0)for(const u of n)s.push(u.route);const i="",r={method:"POST",url:this.config.baseURL+"/simple-wechat-login/",headers:{Authorization:i,"Content-Type":"application/json"},data:e};return console.log("------options",r),(await S(r)).data}}var m={get:function(o){return console.log("---set get",o,localStorage.getItem(o)),localStorage.getItem(o)||null},set:function(o,e){localStorage.setItem(o,e)},gotoHomeOrRole:function(o){const e=JSON.parse(localStorage.getItem("storyCharacters"));console.log("---gotoHomeOrRole",e,e[localStorage.storyId]),d.isEmpty(e)||d.isEmpty(e[localStorage.storyId])||e[localStorage.storyId]==0?o.$router.push("/character"):o.$router.push("/home")},setRole:function(o){const e="storyCharacters",s=JSON.parse(localStorage.getItem(e))||{};s[localStorage.storyId]=o,localStorage.setItem(e,JSON.stringify(s))}};const B={computed:{username(){return this.$route.params.username}},async mounted(){const o=new URL(location.href).searchParams.get("code");localStorage.code=o;const e=new URL(location.href).searchParams.get("storyId");d.isEmpty(e)||(localStorage.storyId=e),d.isEmpty(localStorage.storyId)&&(localStorage.storyId=1),this.goToDashboard()},methods:{goToDashboard:async function(){this.$router.push("/")}}},G=Object.assign(B,{setup(o){return(e,s)=>(l(),P(E(O)))}});var b=(o,e)=>{const s=o.__vccOpts||o;for(const[n,i]of e)s[n]=i;return s};const Z={props:{statement:Object},methods:{statementEvent:function(o,e){console.log("----------",o,e),this.$emit("submit",o,e)}}},H={class:"information"},Q={class:"icon"},D=["src"],X={class:"st-title"},Y={class:"title"},K=$(),ee=t("span",null,"\xA0\xA0\xA0 ",-1),te={class:"time"};function se(o,e,s,n,i,r){return l(),c("view",{class:"charactercell",onClick:e[0]||(e[0]=a=>r.statementEvent(s.statement.id))},[t("view",H,[t("view",Q,[t("img",{class:"icon-img",src:s.statement.avatar},null,8,D)]),t("view",X,[t("view",Y,h(s.statement.name),1),K,ee,t("view",te,h(s.statement.brief_text),1)])])])}var oe=b(Z,[["render",se]]);const ie={class:"container"},ne={class:"spin"},re=t("view",{style:{height:"20px"}},null,-1),ae={class:"choose_character"},le=t("view",{class:"column"},[t("text",{class:"title2"},"\u9009\u62E9\u4F60\u7684\u8EAB\u4EFD")],-1),ce={class:"img-top-shortline"},de=["src"],he={class:"character-statement-list"},ue=["onClick"],pe=["value"],ge=t("view",{style:{height:"30px"}},null,-1),_e={class:"character-bottom"},me=t("text",{style:{"font-size":"20px",color:"white"}},"\u5F00\u59CB\u8C03\u67E5",-1),fe=[me],we=t("view",null,[t("text",{style:{float:"right","margin-right":"10px","font-size":"12px",color:"#757575"}},"*\u63A2\u5458\u8EAB\u4EFD\u4E00\u65E6\u786E\u5B9A\uFF0C\u4E0D\u53EF\u66F4\u6539")],-1),ye=t("view",{style:{height:"50px"}},null,-1),ve={components:{},data(){return{spinning:!1,pickedId:1,roleId:1,imgs:{shortline:"https://assets.storiesmatter.cn/shortline.png"},list:[]}},async mounted(){const e=await new _({}).roles();this.list=e.results},methods:{submit:function(o,e){console.log("---sumit in parent",o,e)},handleInquiry:async function(){this.spinning=!0;const e=await new _({}).initGame(this.roleId);this.spinning=!1,d.isEmpty(e)||(e.code=="e160"?p.success("\u53D1\u73B0\u5377\u5B97\uFF0C\u7EE7\u7EED\u8C03\u67E5"):m.setRoles(this.roleId),this.$router.push("/home"))},handleRadio(o,e){console.log("index",o,e),this.roleId=e,this.pickedId=o+1}}},ke=Object.assign(ve,{setup(o){return(e,s)=>{const n=v("a-spin");return l(),c(w,null,[t("view",ie,[t("div",ne,[f(n,{spinning:e.spinning},null,8,["spinning"])]),re,t("view",ae,[le,t("view",ce,[t("img",{src:e.imgs.shortline,mode:"widthFix"},null,8,de)])]),t("view",he,[(l(!0),c(w,null,k(e.list,(i,r)=>(l(),c("view",{key:r,index:"index",item:"item"},[t("view",{class:"character-cell",onClick:a=>e.handleRadio(r,i.id)},[T(t("input",{class:"character-cell-radio",type:"radio",value:i.id,"onUpdate:modelValue":s[0]||(s[0]=a=>U(pickedId)?pickedId.value=a:null)},null,8,pe),[[L,e.pickedId]]),f(oe,{class:"cell-text",statement:i,onSubmit:e.submit},null,8,["statement","onSubmit"])],8,ue)]))),128))])]),ge,t("view",_e,[t("view",{class:"character-btn",onClick:s[1]||(s[1]=(...i)=>e.handleInquiry&&e.handleInquiry(...i))},fe)]),we,ye],64)}}});const $e={class:"container"},Ie={class:"spin"},be={key:0},xe=["title"],Ce=t("text",null,[t("span",null,"\xA0\xA0\xA0"),$(" \u5BA2\u670D\u5FAE\u4FE1\u8BF7\u6DFB\u52A015711067100 ")],-1),Se=t("text",{class:"copy"},[$(" \u4E00\u952E\u590D\u5236\u8D26\u53F7 "),t("span",null,"\xA0\xA0\xA0")],-1),Te=[Ce,Se],Le={style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},Ve=t("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[t("view",null,"\u641C\u7D22\u6B21\u6570\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u89E3\u9501\u8BB0\u5FC6\u788E\u7247")],-1),Pe=t("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[t("view",null,"\u641C\u7D22\u6B21\u6570\u5DF2\u7ECF\u7528\u5B8C\uFF0C\u8BF7\u5148\u5145\u503C\uFF01")],-1),Ee={class:"header"},Oe={class:"level-1"},Ue={key:0,class:"top-btns"},Fe={class:"column1"},qe={class:"btn1"},Me={class:"btn1"},Re={class:"btn1"},je={key:1,class:"dotline"},Je=["src"],Ne={key:2,class:"userinfo"},ze={class:"icon"},We=["src"],Ae={class:"st-title"},Be={class:"first-line"},Ge={class:"time"},Ze={key:3,class:"dotline"},He=["src"],Qe={key:1,class:"searchcell",id:"searchit"},De=t("view",{class:"recordcell"},[t("view",null,[t("text",{class:"btn1"},"\u8C03\u67E5\u8BB0\u5F55")])],-1),Xe={class:"searchbar"},Ye={class:"search"},Ke={class:"search-block",action:"javascript:void 0"},et=["value"],tt=t("text",null,"\u641C\u7D22",-1),st=[tt],ot={class:"paycell"},it={class:"paycell-title"},nt={class:"btn1"},rt=["src"],at={class:"btn1"},lt={class:"search-longline"},ct=["src"],dt={class:"fragment-content",id:"fragmentContent","wx:key":"index"},ht={class:"fragment-title"},ut={class:"container-box"},pt=["id"],gt={key:0},_t=["onClick"],mt={key:1},ft=["onClick"],wt={class:"longline"},yt=["src"],vt=t("view",{style:{height:"60px"}},null,-1),kt={data(){return{book:"\u6545\u610F\u4E8B\u52A1\u6240\u63A2\u5458\u7CFB\u7EDF",payTitle:"\u8D2D\u4E70\u6B21\u6570",emptyTitle:"",role_stats:[],topic_links:[],my_role:{id:"4",name:"",crew:"",icon_path:"",avatar:""},remain_credit:0,userInfo:!0,dataLoaded:!1,currentTotal:"",submiting:!1,inputValue:"",showAuthorise:!1,isAuthorised:!1,characterId:0,focusSearchInput:!1,justFound:-1,searchScrollTop:286,searching:!1,visible1:!1,isUnlocakModalVisible:!1,gotoTopupVisible:!1,gotoTopupVisible2:!1,isIntroVisible:!1,unlockCredit:0,unlockFragmentId:0,animate:[],windowHeight:750,discoveredList:[],onboard:!1,inWechatBrowser:!1,imageSize:{},px2rpx:2,windowWidth:375,count:1,imgs:{help:"https://assets.storiesmatter.cn/help.png?1",eye:"https://assets.storiesmatter.cn/eye-top.png?2",tick:"https://assets.storiesmatter.cn/tick.png?1",crew:"https://assets.storiesmatter.cn/icon-crew.png",hospital:"https://assets.storiesmatter.cn/icon-hospital.png",delegate:"https://assets.storiesmatter.cn/icon-delegate.png",dot:"https://assets.storiesmatter.cn/dotline.png",search:"https://assets.storiesmatter.cn/search-button.png",pay:"https://assets.storiesmatter.cn/icon-pay.png",line:"https://assets.storiesmatter.cn/longline.png",intromodal:"https://assets.storiesmatter.cn/intromodal.png"},api:null,spinning:!1}},computed:{username(){return this.$route.params.username}},async mounted(){this.spinning=!0,this.api=new _({});const o=await this.api.home();if(this.spinning=!1,o instanceof Error)d.get(o.response.data,"code");else if(!d.isEmpty(o)){this.updateUI(o),this.discoveredList=[];for(var e=0;e<o.role_stats.length;e++){let r=o.role_stats[e];for(var s=0;s<r.fragments.length;s++){let a=r.fragments[s];a.has_discovered==!0&&this.discoveredList.push(a.id)}}}var n=window.navigator.userAgent.toLowerCase();n.match(/MicroMessenger/i)=="micromessenger"?this.inWechatBrowser=!0:this.inWechatBrowser=!1,this.inWechatBrowser=!0;const i="width=device-width, initial-scale=1.0, user-scalable=no";document.querySelector('meta[name="viewport"]').content=i},methods:{handlePieceTap:function(o){let e=this.discoveredList.indexOf(o);e!=null&&(console.log("--- this.discoveredList",this.discoveredList),this.$router.push({path:"/piece",query:{id:o,index:e,discoveredList:this.discoveredList}}))},handleUnlockedPieceTap:function(o,e){console.log("---fragmentId",o,e),this.unlockFragmentId=o,this.isUnlocakModalVisible=!0,this.unlockCredit=e},onClick:function(){this.requestUnlockedPiece()},onDismiss:function(){this.$toast.clear()},creditZero:function(){this.inWechatBrowser?this.gotoTopupVisible2=!0:p.warning("\u641C\u7D22\u6B21\u6570\u5DF2\u7528\u5B8C\uFF0C\u8BF7\u5148\u8054\u7CFB\u5BA2\u670D\u54E6\uFF01")},async requestUnlockedPiece(){this.spinning=!0;const o=await this.api.unlock(this.unlockFragmentId);this.spinning=!1,o!=null?o.code=="e190"||o.code=="e120"?this.inWechatBrowser?this.gotoTopupVisible=!0:this.copy():o.code==null&&(this.justFound=o.id,this.getChanllengeList()):p.error("\u89E3\u9501\u8BB0\u5FC6\u788E\u7247\u5931\u8D25")},handleGotoTopup:function(){this.gotoTopupVisible=!1,this.$router.push({path:"/topup"})},handleCancelTopup:function(){this.gotoTopupVisible=!1,this.gotoTopupVisible2=!1},async requestSearch(){if(console.log("---requestSearch",this.inputValue,this.remain_credit),this.remain_credit<=0){this.creditZero();return}if(this.inputValue.length==0){p.warning("\u8BF7\u8F93\u5165\u5173\u952E\u8BCD");return}if(this.inputValue.length>7){p.warning("\u5173\u952E\u8BCD\u6700\u957F\u4E0D\u8D85\u8FC77\u4E2A\u5B57");return}var o=new RegExp("[\u4E00-\u9FA5A-Za-z0-9]+$","g");if(!o.test(this.inputValue)){p.warning("\u5173\u952E\u8BCD\u90FD\u4E0D\u542B\u6807\u70B9\u54E6");return}if(this.searching==!0)return;this.searching=!0,this.spinning=!0;const e=await this.api.search(this.inputValue);if(this.spinning=!1,this.searching=!1,!d.isEmpty(e))if(d.isEmpty(e.code))m.set("searchedCount",0),this.justFound=e.id,this.getChanllengeList();else{this.focusSearchInput=!0,this.focusSearchInput=!1;let s=null;if(e.code=="e120")this.creditZero(),this.focusSearchInput=!1;else if(e.code=="e110")s="\u8BA2\u5355\u4E0D\u5B58\u5728";else if(e.code=="e100")s="\u6E38\u620F\u4E3B\u9898\u4E0D\u5B58\u5728";else if(e.code=="e130"){s="\u6C92\u627E\u5230\u76F8\u5173\u788E\u7247\uFF0C\u8BF7\u91CD\u65B0\u641C\u7D22";let n=m.get("searchedCount");n==null&&(n=0),n++,m.set("searchedCount",n),n>=5&&(s="\u5361\u4F4F\u4E86\uFF1F\u8054\u7CFB\u5BA2\u670D\u8981\u4E2A\u63D0\u793A\u5427\uFF01",m.set("searchedCount",0))}s&&p.warning(s),this.remain_credit==0||(this.remain_credit=this.remain_credit-1)}this.inputValue=""},updateUI:function(o){this.my_role.name=o.my_role.name,this.my_role.avatar=o.my_role.avatar;let e=o.other_roles,s="";for(var n=e.length-1;n>=0;n--)s=s+e[n].name+(n==0?"":"\uFF0C");this.my_role.crew=s,this.role_stats=o.role_stats,this.remain_credit=o.remain_credit,this.topic_links=o.topic_links,this.topic_links.length<3&&(this.topic_links.push({title:"",link_url:""}),this.topic_links.push({title:"",link_url:""})),m.setRole(this.my_role.id),this.dataLoaded=!0,this.isAuthorised=!0,this.justFound>0&&(document.getElementById(`cv${this.justFound}`).scrollIntoView(),p.warning("\u6210\u529F\u627E\u5230\u788E\u7247"),this.justFound=-1)},handleHelp:function(o){window.location.href=this.topic_links[o].link_url},handleTopup:function(o){this.$router.push({path:"/topup"})},copy:function(o){this.$copyText("15711067100").then(function(e){alert("Copied"),console.log(e)},function(e){alert("Can not copy"),console.log(e)})},handleOk:function(){this.visible1=!1},handleCancel:function(){this.visible1=!0},handleUnlockOk(){this.isUnlocakModalVisible=!1,this.requestUnlockedPiece()},handleUnlockCancel(){this.isUnlocakModalVisible=!1},async getChanllengeList(){const o=await this.api.home();if(console.log("home data: ",o instanceof Error),!(o instanceof Error)&&!d.isEmpty(o)){this.updateUI(o),this.discoveredList=[];for(var e=0;e<o.role_stats.length;e++){let n=o.role_stats[e];for(var s=0;s<n.fragments.length;s++){let i=n.fragments[s];i.has_discovered==!0&&this.discoveredList.push(i.id)}}}}}},$t=Object.assign(kt,{setup(o){return(e,s)=>{const n=v("a-spin"),i=v("a-modal");return l(),c("view",$e,[t("div",Ie,[f(n,{spinning:e.spinning},null,8,["spinning"])]),e.isAuthorised?g("",!0):(l(),c("view",be,[t("text",{title:e.emptyTitle},null,8,xe)])),t("view",{class:"systemprompt",onClick:s[0]||(s[0]=(...r)=>e.copy&&e.copy(...r))},Te),f(i,{title:"",visible:e.isUnlocakModalVisible,onOk:e.handleUnlockOk,onCancel:e.handleUnlockCancel,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u89E3\u9501",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:I(()=>[t("view",Le,[t("view",null,"\u8BE5\u8BB0\u5FC6\u788E\u7247\u5C1A\u672A\u89E3\u9501\uFF0C\u8981\u6D88\u8017"+h(e.unlockCredit)+"\u6B21\u641C\u7D22\u673A\u4F1A\u89E3\u9501\u5417\uFF1F",1)])]),_:1},8,["visible","onOk","onCancel"]),f(i,{title:"",visible:e.gotoTopupVisible,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:I(()=>[Ve]),_:1},8,["visible","onOk","onCancel"]),f(i,{title:"",visible:e.gotoTopupVisible2,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:I(()=>[Pe]),_:1},8,["visible","onOk","onCancel"]),t("view",Ee,[t("view",Oe,[t("text",null,h(e.book),1)]),e.dataLoaded?(l(),c("view",Ue,[t("view",Fe,[t("view",{class:"btns",onClick:s[1]||(s[1]=r=>e.handleHelp(0))},[t("text",qe,h(e.topic_links[0].title),1)]),t("view",{class:"btns",onClick:s[2]||(s[2]=r=>e.handleHelp(1))},[t("text",Me,h(e.topic_links[1].title),1)]),t("view",{class:"btns",onClick:s[3]||(s[3]=r=>e.handleHelp(2))},[t("text",Re,h(e.topic_links[2].title),1)])])])):g("",!0),e.dataLoaded?(l(),c("view",je,[t("img",{src:e.imgs.dot},null,8,Je)])):g("",!0),e.dataLoaded?(l(),c("view",Ne,[t("view",ze,[t("img",{src:e.my_role.avatar},null,8,We)]),t("view",Ae,[t("view",Be,"\u63A2\u5458\uFF1A"+h(e.my_role.name),1),t("view",Ge,"\u7EC4\u5458\uFF1A"+h(e.my_role.crew),1)])])):g("",!0),e.dataLoaded?(l(),c("view",Ze,[t("img",{src:e.imgs.dot},null,8,He)])):g("",!0)]),e.dataLoaded?(l(),c("view",Qe,[De,t("view",Xe,[t("view",Ye,[t("form",Ke,[t("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u4F60\u60F3\u8981\u7684\u5185\u5BB9",value:e.inputValue,onInput:s[4]||(s[4]=r=>e.inputValue=r.target.value),onKeyup:s[5]||(s[5]=F((...r)=>e.requestSearch&&e.requestSearch(...r),["13"]))},null,40,et)])]),t("view",{class:"search-btn",onClick:s[6]||(s[6]=r=>e.requestSearch())},st)]),t("view",ot,[t("view",it,[t("text",nt,"\u641C\u7D22\u5269\u4F59\u6B21\u6570\uFF1A"+h(e.remain_credit),1)]),t("view",{class:"topup",onClick:s[7]||(s[7]=(...r)=>e.handleTopup&&e.handleTopup(...r))},[t("img",{src:e.imgs.pay},null,8,rt),t("text",at,h(e.payTitle),1)])]),t("view",lt,[t("img",{src:e.imgs.line,mode:"widthFix"},null,8,ct)])])):g("",!0),(l(!0),c(w,null,k(e.role_stats,r=>(l(),c("view",dt,[t("view",ht,[t("text",null,h(r.role),1)]),t("view",ut,[(l(!0),c(w,null,k(r.fragments,a=>(l(),c("view",{class:q(a.has_discovered?"item-box discovered":"item-box"),id:`cv${a.id}`},[a.has_discovered==!0?(l(),c("view",gt,[t("text",{animation:"{{animate[item.id]}}",onClick:u=>e.handlePieceTap(a.id),"data-cid":"item.id"},h(a.display_label),9,_t)])):(l(),c("view",mt,[t("text",{onClick:u=>e.handleUnlockedPieceTap(a.id,a.credit_to_unlock)},h(a.display_label),9,ft)]))],10,pt))),256))]),t("view",wt,[t("img",{src:e.imgs.line,mode:"widthFix"},null,8,yt)])]))),256)),vt])}}});const It={class:"container"},bt=t("view",{style:{height:"40px"}},null,-1),xt={class:"choose_character"},Ct=t("view",{class:"column"},[t("text",{class:"title2"},"\u767B\u5F55")],-1),St={class:"img-top-shortline"},Tt=["src"],Lt={class:"login"},Vt=t("view",{class:"recordcell"},[t("view")],-1),Pt={class:"login-bar"},Et={class:"login-search"},Ot={class:"search-block",action:"javascript:void 0"},Ut=["value"],Ft={class:"login-row"},qt={class:"login-search login-search1"},Mt={class:"search-block",action:"javascript:void 0"},Rt=["value"],jt=t("text",null,"\u83B7\u53D6\u9A8C\u8BC1\u7801",-1),Jt=[jt],Nt=t("text",{class:"login-sure-btn"},"\u786E\u5B9A",-1),zt=[Nt],Wt={data(){return{inputValue:"",inputCode:"",phoneNumber:"",imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png"}}},methods:{compositionUpdate:function(o){this.phoneNumber=o.data},getCode:async function(){if(this.inputValue.length==0){p.warning("\u8BF7\u8F93\u5165\u624B\u673A\u53F7");return}const e=await new _({}).getCode(this.inputValue);d.isEmpty(e)||d.get(e,"status")=="ok"&&p.success("\u53D1\u9001\u6210\u529F")},phonenoLogin:async function(){if(this.inputCode.length==0){p.warning("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801");return}const e=await new _({}).phonenoLogin(this.inputValue,this.inputCode);d.isEmpty(e)||(d.get(e,"status")=="ok"?(p.success("\u767B\u5F55\u6210\u529F"),this.gotoHomePage()):p.error(e.message))},gotoHomePage:function(){const o=JSON.parse(localStorage.getItem("storyCharacters"));d.isEmpty(o)||o[localStorage.storyId]==0?this.$router.push("/character"):this.$router.push("/home")}}},At=Object.assign(Wt,{setup(o){return(e,s)=>(l(),c("view",It,[bt,t("view",xt,[Ct,t("view",St,[t("img",{src:e.imgs.shortLine,mode:"widthFix"},null,8,Tt)])]),t("view",Lt,[Vt,t("view",Pt,[t("view",Et,[t("form",Ot,[t("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u4F60\u7684\u624B\u673A\u53F7",value:e.inputValue,onInput:s[0]||(s[0]=n=>e.inputValue=n.target.value)},null,40,Ut)])]),t("view",Ft,[t("view",qt,[t("form",Mt,[t("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u624B\u673A\u9A8C\u8BC1\u7801",value:e.inputCode,onInput:s[1]||(s[1]=n=>e.inputCode=n.target.value)},null,40,Rt)])]),t("view",{class:"get-code-text",onClick:s[2]||(s[2]=(...n)=>e.getCode&&e.getCode(...n))},Jt)])])]),t("view",{class:"login-sure",onClick:s[3]||(s[3]=(...n)=>e.phonenoLogin&&e.phonenoLogin(...n))},zt)]))}});const Bt={data(){return{search_text:"",content_type:1,display_id:"",role:"",comment:"",text:"",image:"",pictures:[""],imageSize:{},px2px:2,windowWidth:375,src:"",curTime:"00:00",endTime:"00:00",reCurTime:"",reEndTime:"",playurl:"",status:"",cdCls:"pause",currentDot:0,isplay:!1,timer:"",currentFragmentId:87,discoveredList:[],currentPieceIndex:0,last:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png",eye:"https://assets.storiesmatter.cn/eye.png",play:"https://assets.storiesmatter.cn/play1.png",pause:"https://assets.storiesmatter.cn/pause1.png"},imgWidth:375}},async mounted(){this.imgWidth=document.documentElement.clientWidth||document.body.clientWidth,d.isEmpty(this.$route.query)||(this.discoveredList=this.$route.query.discoveredList,this.currentPieceIndex=this.$route.query.index),this.gotoPiece();const o="width=device-width, initial-scale=1.0, user-scalable=yes";document.querySelector('meta[name="viewport"]').content=o},methods:{gotoMap(){},async requestFragment(){this.$toast.open({message:"\u6B63\u5728\u52A0\u8F7D...",duration:2e3,dismissible:!1});const e=await new _({}).fragments(this.currentFragmentId);e!=null&&(this.search_text=e.search_text,this.content_type=e.content_type,this.role=e.role_name,this.display_id=e.display_id,this.comment=e.comment,this.text=e.text,this.playurl=e.audio,this.image=e.image,this.pictures.push(e.image),this.playurl!=null&&this.content_type==3),this.$toast.clear()},gotoPiece(){this.onUnloadAudio(),this.currentFragmentId=this.discoveredList[this.currentPieceIndex],parseInt(this.currentPieceIndex)+1==this.discoveredList.length?this.last=!0:this.last=!1,console.log("this.currentFragmentId",this.currentFragmentId),this.currentFragmentId!=null&&(this.pictures=[],this.imageSize=[],this.requestFragment())},previous(){this.currentPieceIndex<=0||(this.currentPieceIndex--,this.gotoPiece())},next(){parseInt(this.currentPieceIndex)+1>=this.discoveredList.length||(this.currentPieceIndex++,this.gotoPiece())},onUnloadAudio(){clearInterval(this.timer)},onUnload(){this.onUnloadAudio()}}},Gt={class:"container"},Zt=t("view",{style:{height:"40px"}},null,-1),Ht={class:"choose_character"},Qt={class:"column"},Dt=["src"],Xt=t("view",{style:{width:"10px"}},null,-1),Yt={style:{"font-size":"18px"}},Kt={class:"img-top-shortline"},es=["src"],ts={class:"userinfobtns"},ss={class:"column"},os={class:"btn"},is={class:"btn"},ns={class:"btn"},rs=["src"],as={key:1,class:"sliderCont"},ls=["src"],cs={key:2,class:"message"},ds=t("view",{style:{height:"100px"}},null,-1),hs={class:"bottom1"},us={class:"column1"},ps={key:0},gs={key:1},_s=t("text",{decode:"{{true}}"},"\u4E0A\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),ms=[_s],fs={key:2},ws={key:3},ys=t("text",{decode:"{{true}}"},"\u4E0B\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),vs=[ys];function ks(o,e,s,n,i,r){return l(),c("view",Gt,[Zt,t("view",Ht,[t("view",Qt,[t("img",{style:{width:"30px",height:"15px","margin-top":"7px"},src:i.imgs.eye},null,8,Dt),Xt,t("text",Yt,h(i.search_text),1)]),t("view",Kt,[t("img",{src:i.imgs.shortLine,mode:"widthFix"},null,8,es)])]),t("view",ts,[t("view",ss,[t("view",os,[t("text",null,h(i.display_id),1)]),t("view",is,[t("text",null,h(i.role),1)]),t("view",ns,[t("text",null,h(i.comment),1)])])]),i.content_type==2?(l(),c("view",{key:0,class:"fragment-img",onClick:e[0]||(e[0]=(...a)=>r.gotoMap&&r.gotoMap(...a))},[t("view",null,[t("img",{src:i.pictures[0],style:M({width:i.imgWidth+"px"}),mode:"scaleToFill"},null,12,rs)])])):g("",!0),i.content_type==3?(l(),c("view",as,[t("audio",{src:i.playurl,controls:"controls",class:"aaudio"},null,8,ls)])):g("",!0),i.content_type==1?(l(),c("text",cs,h(i.text),1)):g("",!0),ds,t("view",hs,[t("view",us,[i.currentPieceIndex==0?(l(),c("view",ps)):(l(),c("view",gs,[t("view",{class:"btn1",onClick:e[1]||(e[1]=(...a)=>r.previous&&r.previous(...a))},ms)])),i.last==!0?(l(),c("view",fs)):(l(),c("view",ws,[t("view",{class:"btn1",onClick:e[2]||(e[2]=(...a)=>r.next&&r.next(...a))},vs)]))])])])}var $s=b(Bt,[["render",ks]]);const Is={components:{},data(){return{pickedId:1,list:[],currentId:"1",position:"left",disabled:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png"},imageSize:{},px2rpx:2,windowWidth:375,videoAd:null,inWechatBrowser:!1,api:null,spinning:!1,appId:"wx4cbaf7126c634959",uri:"",wcode:"1212code"}},onLoad(o){o.type!=null&&(this.type=o.type)},mounted(){var o=window.navigator.userAgent.toLowerCase();o.match(/MicroMessenger/i)=="micromessenger"?this.inWechatBrowser=!0:this.inWechatBrowser=!1;let e=encodeURIComponent("http://fangnu.fun/");console.log("a",window.location.href),this.uri=`https://open.weixin.qq.com/connect/oauth2/authorize?appid=${this.appId}&redirect_uri=`+e+"&response_type=code&scope=snsapi_base&state=STATE&connect_redirect=1#wechat_redirect";let s=this.GetQueryString("code");console.log("code",s),this.wcode=localStorage.code},computed:{},methods:{greet:async function(o){this.spinning=!0,this.api=new _({});const e=await this.api.pricing();this.spinning=!1,e==null||(this.list=e.results,m.set("pricing",e.results))},redirect_url(o){wx.navigateTo({url:`/pages/categories/child?id=${o}&type=${this.type}`})},handleFruitChange({detail:o={}}){this.current=o.value},handleRadio(o,e){console.log("index",o,e),this.currentId=e,this.pickedId=o+1},radioChange({detail:o={}}){this.currentId=o.value},GetQueryString(o){let e=new RegExp("(^|&)"+o+"=([^&]*)(&|$)"),s=window.location.search.substr(1).match(e);return console.log("newUrl",s),s!=null?unescape(s[2]):!1},async handlePay2(){this.GetQueryString("code")||(alert("\u8DF3\u8F6C"),window.location.href=this.uri)},async handlePay1(){await this.handlePay2()},onBridgeReady(){this.api.orders(this.currentId).then(o=>{if(!d.isEmpty(o)&&o.status==="ok"){const{appId:e=this.appId,timeStamp:s,nonceStr:n,paySign:i}=o,r="MD5",a=o.package;console.log("nonceStr",n),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e,timeStamp:s,nonceStr:n,package:a,signType:r,paySign:i},function(u){console.log("res",u),u.err_msg=="get_brand_wcpay_request:ok"?console.log("\u652F\u4ED8\u6210\u529F"):console.log("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8")})}})}}},bs={class:"container"},xs={class:"spin"},Cs=t("view",{style:{height:"40px"}},null,-1),Ss={class:"choose_character"},Ts={class:"column"},Ls={class:"title2"},Vs={class:"img-top-shortline"},Ps=["src"],Es={class:"statement-list"},Os=["onClick"],Us=["value"],Fs={class:"cell-text"},qs=t("p",null,null,-1),Ms=t("p",null,null,-1),Rs=t("text",{class:"svg-demo-text"}," \u5FAE\u4FE1\u652F\u4ED8",-1),js=[Rs];function Js(o,e,s,n,i,r){const a=v("a-spin");return l(),c("view",bs,[t("div",xs,[f(a,{spinning:i.spinning},null,8,["spinning"])]),Cs,t("view",Ss,[t("view",Ts,[t("text",Ls,h(i.wcode)+"\u8D2D\u4E70\u641C\u7D22\u6B21\u6570",1)]),t("view",Vs,[t("img",{src:i.imgs.shortLine,mode:"widthFix"},null,8,Ps)])]),t("view",Es,[(l(!0),c(w,null,k(i.list,(u,x)=>(l(),c("view",{key:x,index:"index",item:"item"},[t("view",{class:"cell",onClick:C=>r.handleRadio(x,u.id)},[T(t("input",{class:"cell-radio",type:"radio",value:u.id,"onUpdate:modelValue":e[0]||(e[0]=C=>i.pickedId=C)},null,8,Us),[[L,i.pickedId]]),t("text",Fs,h(u.credit)+"\u6B21\u641C\u7D22 \xA5"+h(u.price),1),qs],8,Os)]))),128))]),Ms,$(" "+h(i.uri)+" ",1),t("view",{class:"pay",onClick:e[1]||(e[1]=(...u)=>r.handlePay1&&r.handlePay1(...u))},js)])}var Ns=b(Is,[["render",Js]]);const zs=R({history:j("/"),routes:[{path:"/home",name:"home",component:$t},{path:"/character",name:"character",component:ke},{path:"/piece",component:$s},{path:"/login",component:At},{path:"/",component:Ns}]});const y=J(G);y.use(zs);y.use(N,{position:"top"});y.use(z);y.use(W);y.mount("#app");
