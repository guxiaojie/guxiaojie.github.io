import{_ as a,a as C,o as c,c as q,u as b,R as B,m as h,b as l,d as t,t as u,e as x,r as v,f as p,F as y,g as k,w as L,v as P,i as T,h as g,j as $,k as F,n as V,l as O,p as W,q as A,s as j,V as M,x as z,A as H}from"./vendor.dc04f490.js";const J=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}};J();let E="";E="https://www.storiesmatter.cn";class _{constructor(e){this.storyId=1,!a.isEmpty(localStorage.storyId)&&localStorage.storyId!=="null"&&(this.storyId=localStorage.storyId),this.config=e,this.config.baseURL=E+"/api",this.token()}token(){var e="Bearer "+localStorage.token;this.axios=C.create({baseURL:this.config.baseURL,timeout:5e3}),this.axios.defaults.headers.common.Authorization=e}async roles(){return(await this.axios.get(`topics/${this.storyId}/roles/`)).data}async home(){try{return(await this.axios.get(`topics/${this.storyId}/home/`)).data}catch(e){return e}}async initGame(e){try{return(await this.axios.post(`topics/${this.storyId}/init-game/`,{role_id:e})).data}catch(i){return i}}async fragments(e){return(await this.axios.get(`fragments/${e}/`)).data}async search(e){try{return(await this.axios.get(`topics/${this.storyId}/fragments/?q=${e}`)).data}catch{return null}}async unlock(e){return(await this.axios.post(`topics/${this.storyId}/fragments/${e}/unlock/`)).data}async pricing(){return(await this.axios.get(`topics/${this.storyId}/pricing/`)).data}async orders(e,i){try{return(await this.axios.post(`topics/${this.storyId}/orders/`,{pricing_id:e,js_code:i})).data}catch(o){const n=a.get(o.response.data,"msg"),r=a.get(o.response.data,"errmsg");return a.isEmpty(n)?a.isEmpty(r)||(o.message=r):o.message=n,o}}async getCode(e){try{return(await this.axios.post("phoneno-get-code/",{phone_no:e})).data}catch(i){const o=a.get(i.response.data,"non_field_errors"),n=a.get(i.response.data,"phone_no");if(a.isEmpty(o)){if(!a.isEmpty(n))return i.message=n[0],i}else return i.message=o[0],i}}async phonenoLogin(e,i){try{const o=await this.axios.post("phoneno-login/",{phone_no:e,user_input_code:i});return localStorage.token=a.get(o.data,"access"),localStorage.refresh=a.get(o.data,"refresh"),o.data}catch(o){const n=a.get(o.response.data,"non_field_errors"),r=a.get(o.response.data,"user_input_code");if(a.isEmpty(n)){if(!a.isEmpty(r))return o.message=r[0],o}else return o.message=n[0],o;return o}}async tokenVerify(){try{const e=await this.axios.post("token/verify/",{token:localStorage.token});return!0}catch{return a.isEmpty(localStorage.refresh)?!1:await new _({}).tokenRefresh()}}async tokenRefresh(){try{const e=await this.axios.post("token/refresh/",{refresh:localStorage.refresh});return a.isEmpty(e.data)?!1:(localStorage.token=a.get(e.data,"access"),!0)}catch(e){return console.log("tokenRefresh",e),!1}}async login(){const e={avatar_url:"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6pjAcqAwjE9l9Yc8bex4lrJ2PFE9rnJXvM0oSicxW8liadwT46J3pOMdHJ1scGR2jHiaEnVHWqcdYMA/132",city:"",country:"",gender:0,js_code:"091gvxGa1ypdMC0tOrJa1cOmJQ1gvxG3",language:"zh_CN",nick_name:"\u8C37\u6653\u6D01Sage",province:""},i=[],o="";if(o.length>0)for(const f of o)i.push(f.route);const n="",r={method:"POST",url:this.config.baseURL+"/simple-wechat-login/",headers:{Authorization:n,"Content-Type":"application/json"},data:e};return(await C(r)).data}}const R="\u4EACICP\u590714009930\u53F7-4";var m={get:function(s){return localStorage.getItem(s)||null},set:function(s,e){localStorage.setItem(s,e)},getVersion:function(){return"v2.0.9"}};const N={computed:{username(){return this.$route.params.username}},async mounted(){const s=new URL(location.href).searchParams.get("storyId");a.isEmpty(s)||(localStorage.storyId=s),a.isEmpty(localStorage.storyId)&&(localStorage.storyId=1),this.goToDashboard()},methods:{goToDashboard:async function(){if(!navigator.onLine){h.error("\u8BF7\u68C0\u67E5\u7F51\u7EDC");return}a.isEmpty(localStorage.token)?this.$router.push("/login"):(await new _({}).tokenVerify()||this.$router.push("/login"),console.log("Load App"))}}},G=Object.assign(N,{setup(s){return(e,i)=>(c(),q(b(B)))}});var I=(s,e)=>{const i=s.__vccOpts||s;for(const[o,n]of e)i[o]=n;return i};const D={props:{statement:Object},methods:{statementEvent:function(s,e){this.$emit("submit",s,e)}}},Z={class:"information"},K={class:"icon"},Q=["src"],Y={class:"st-title"},X={class:"title"},ee=x(),te=t("span",null,"\xA0\xA0\xA0 ",-1),se={class:"time"};function ie(s,e,i,o,n,r){return c(),l("view",{class:"charactercell",onClick:e[0]||(e[0]=d=>r.statementEvent(i.statement.id))},[t("view",Z,[t("view",K,[t("img",{class:"icon-img",src:i.statement.avatar},null,8,Q)]),t("view",Y,[t("view",X,u(i.statement.name),1),ee,te,t("view",se,u(i.statement.brief_text),1)])])])}var ne=I(D,[["render",ie]]);const oe={class:"container"},re={class:"spin"},ae=t("view",{style:{height:"20px"}},null,-1),ce={class:"choose_character"},le=t("view",{class:"column"},[t("text",{class:"title2"},"\u9009\u62E9\u4F60\u7684\u8EAB\u4EFD")],-1),de={class:"img-top-shortline"},he=["src"],ue={class:"character-statement-list"},pe=["onClick"],_e=["value"],ge=t("view",{style:{height:"30px"}},null,-1),me={class:"character-bottom"},fe=t("text",{style:{"font-size":"20px",color:"white"}},"\u5F00\u59CB\u8C03\u67E5",-1),ve=[fe],ye=t("view",null,[t("text",{style:{float:"right","margin-right":"10px","font-size":"12px",color:"#757575"}},"*\u63A2\u5458\u8EAB\u4EFD\u4E00\u65E6\u786E\u5B9A\uFF0C\u4E0D\u53EF\u66F4\u6539")],-1),we=t("view",{style:{height:"50px"}},null,-1),ke={components:{},data(){return{spinning:!1,pickedId:1,roleId:0,imgs:{shortline:"https://assets.storiesmatter.cn/shortline.png"},list:[]}},async mounted(){const e=await new _({}).roles();this.list=e.results},methods:{submit:function(s,e){console.log("---sumit in parent",s,e)},handleInquiry:async function(){this.spinning=!0,this.roleId==0&&h.info("\u8BF7\u786E\u5B9A\u63A2\u5458\u8EAB\u4EFD");const e=await new _({}).initGame(this.roleId);this.spinning=!1,a.isEmpty(e)||(e.code=="e160"&&h.success("\u53D1\u73B0\u5377\u5B97\uFF0C\u7EE7\u7EED\u8C03\u67E5"),this.$router.push("/home"))},handleRadio(s,e){this.roleId=e,this.pickedId=s+1}}},$e=Object.assign(ke,{setup(s){return(e,i)=>{const o=v("a-spin");return c(),l(y,null,[t("view",oe,[t("div",re,[p(o,{spinning:e.spinning},null,8,["spinning"])]),ae,t("view",ce,[le,t("view",de,[t("img",{src:e.imgs.shortline,mode:"widthFix"},null,8,he)])]),t("view",ue,[(c(!0),l(y,null,k(e.list,(n,r)=>(c(),l("view",{key:r,index:"index",item:"item"},[t("view",{class:"character-cell",onClick:d=>e.handleRadio(r,n.id)},[L(t("input",{class:"character-cell-radio",type:"radio",value:n.id,"onUpdate:modelValue":i[0]||(i[0]=d=>T(pickedId)?pickedId.value=d:null)},null,8,_e),[[P,e.pickedId]]),p(ne,{class:"cell-text",statement:n,onSubmit:e.submit},null,8,["statement","onSubmit"])],8,pe)]))),128))])]),ge,t("view",me,[t("view",{class:"character-btn",onClick:i[1]||(i[1]=(...n)=>e.handleInquiry&&e.handleInquiry(...n))},ve)]),ye,we],64)}}}),be={class:"container"},xe=t("span",null,"\xA0\xA0\xA0",-1),Ie=t("text",{class:"copy"},[x(" \u4E00\u952E\u590D\u5236\u8D26\u53F7 "),t("span",null,"\xA0\xA0\xA0")],-1),Ce={data(){return{title:"\u5BA2\u670D\u5FAE\u4FE1\u8BF7\u6DFB\u52A015711067100"}},props:{homePage:Object},async mounted(){this.homePage?this.title="\u5BA2\u670D\u5FAE\u4FE1\u8BF7\u6DFB\u52A015711067100":this.title="\u83B7\u53D6\u514D\u8D39\u6B21\u6570\u8BF7\u6DFB\u52A0\u5BA2\u670D\u5FAE\u4FE115711067100"},methods:{copy:function(s){this.$copyText("15711067100").then(function(e){h.success("\u5DF2\u590D\u5236\u5BA2\u670D\u5FAE\u4FE1: 15711067100")},function(e){h.error(e.message)})}}},U=Object.assign(Ce,{setup(s){return(e,i)=>(c(),l("view",be,[t("view",{class:"systemprompt",onClick:i[0]||(i[0]=(...o)=>e.copy&&e.copy(...o))},[t("text",null,[xe,x(u(e.title),1)]),Ie])]))}});const Se={class:"container"},Le={class:"spin"},Pe={key:0},Te=["title"],Ve={style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},Ee=t("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[t("view",null,"\u641C\u7D22\u6B21\u6570\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u89E3\u9501\u8BB0\u5FC6\u788E\u7247")],-1),Re=t("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[t("view",null,"\u641C\u7D22\u6B21\u6570\u5DF2\u7ECF\u7528\u5B8C\uFF0C\u8BF7\u5148\u5145\u503C\uFF01")],-1),Ue={class:"header"},qe={class:"level-1"},Be={key:0,class:"top-btns"},Fe={class:"column1"},Oe={class:"btn1"},We={class:"btn1"},Ae={class:"btn1"},je={key:1,class:"dotline"},Me=["src"],ze={key:2,class:"userinfo"},He={class:"icon"},Je=["src"],Ne={class:"home-st-title"},Ge={class:"first-line"},De={class:"time"},Ze={key:3,class:"dotline"},Ke=["src"],Qe={key:1,class:"searchcell",id:"searchit"},Ye=t("view",{class:"recordcell"},[t("view",null,[t("text",{class:"btn1"},"\u8C03\u67E5\u8BB0\u5F55")])],-1),Xe={class:"searchbar"},et={class:"search"},tt={class:"search-block",action:"javascript:void 0"},st=["value"],it=t("text",null,"\u641C\u7D22",-1),nt=[it],ot={class:"paycell"},rt={class:"paycell-title"},at={class:"btn1"},ct=["src"],lt={class:"btn1"},dt={class:"search-longline"},ht=["src"],ut={class:"fragment-content",id:"fragmentContent","wx:key":"index"},pt={class:"fragment-title"},_t={class:"container-box"},gt=["id"],mt={key:0},ft=["onClick"],vt={key:1},yt=["onClick"],wt={class:"longline"},kt=["src"],$t={class:"home-version"},bt=t("view",{style:{height:"60px"}},null,-1),xt={data(){return{book:"\u6545\u610F\u4E8B\u52A1\u6240\u63A2\u5458\u7CFB\u7EDF",payTitle:"\u8D2D\u4E70\u6B21\u6570",emptyTitle:"",role_stats:[],topic_links:"",my_role:{id:"4",name:"",crew:"",icon_path:"",avatar:""},remain_credit:0,userInfo:!0,dataLoaded:!1,currentTotal:"",submiting:!1,inputValue:"",showAuthorise:!1,isAuthorised:!1,characterId:0,justFound:-1,searchScrollTop:286,searching:!1,visible1:!1,isUnlocakModalVisible:!1,gotoTopupVisible:!1,gotoTopupVisible2:!1,unlockCredit:0,unlockFragmentId:0,animate:[],windowHeight:750,discoveredList:[],onboard:!1,inWechatBrowser:!1,imageSize:{},px2rpx:2,windowWidth:375,count:1,imgs:{help:"https://assets.storiesmatter.cn/help.png?1",eye:"https://assets.storiesmatter.cn/eye-top.png?2",tick:"https://assets.storiesmatter.cn/tick.png?1",crew:"https://assets.storiesmatter.cn/icon-crew.png",hospital:"https://assets.storiesmatter.cn/icon-hospital.png",delegate:"https://assets.storiesmatter.cn/icon-delegate.png",dot:"https://assets.storiesmatter.cn/dotline.png",search:"https://assets.storiesmatter.cn/search-button.png",pay:"https://assets.storiesmatter.cn/icon-pay.png",line:"https://assets.storiesmatter.cn/longline.png",intromodal:"https://assets.storiesmatter.cn/intromodal.png"},api:null,spinning:!1}},computed:{username(){return this.$route.params.username}},async mounted(){const s=m.get("home");a.isEmpty(s)||this.updateUI(JSON.parse(s)),this.spinning=!0,this.api=new _({});const e=await this.api.home();if(this.spinning=!1,e instanceof Error){if(a.get(e,"message")&&a.get(e,"message")=="Network Error")return;const n=a.get(e.response.data,"code");n=="e110"?this.$router.push("/character"):n=="token_not_valid"?this.$router.push({path:"/login"}):n=="e100"&&h.error("\u6E38\u620F\u4E3B\u9898\u4E0D\u5B58\u5728")}else a.isEmpty(e)||(m.set("home",JSON.stringify(e)),this.updateUI(e));var i=window.navigator.userAgent.toLowerCase();i.match(/MicroMessenger/i)=="micromessenger"?this.inWechatBrowser=!0:this.inWechatBrowser=!1,this.inWechatBrowser=!0;const o="width=device-width, initial-scale=1.0, user-scalable=no";document.querySelector('meta[name="viewport"]').content=o},methods:{handlePieceTap:function(s){let e=this.discoveredList.indexOf(s);e!=null&&(console.log("--- this.discoveredList",this.discoveredList),this.$router.push({path:"/piece",query:{id:s,index:e,discoveredList:this.discoveredList}}))},handleUnlockedPieceTap:function(s,e){this.unlockFragmentId=s,this.isUnlocakModalVisible=!0,this.unlockCredit=e},onClick:function(){this.requestUnlockedPiece()},onDismiss:function(){this.$toast.clear()},creditZero:function(){this.inWechatBrowser?this.gotoTopupVisible2=!0:h.warning("\u641C\u7D22\u6B21\u6570\u5DF2\u7528\u5B8C\uFF0C\u8BF7\u5148\u8054\u7CFB\u5BA2\u670D\u54E6\uFF01")},async requestUnlockedPiece(){this.spinning=!0;const s=await this.api.unlock(this.unlockFragmentId);this.spinning=!1,s!=null?s.code=="e190"||s.code=="e120"?this.inWechatBrowser?this.gotoTopupVisible=!0:h.error("\u8BF7\u6DFB\u52A0\u5BA2\u670D\u5FAE\u4FE1"):s.code==null&&(this.justFound=s.id,this.requestHomeAfter()):h.error("\u89E3\u9501\u8BB0\u5FC6\u788E\u7247\u5931\u8D25")},handleGotoTopup:function(){this.gotoTopupVisible=!1,this.$router.push({path:"/topup"})},handleCancelTopup:function(){this.gotoTopupVisible=!1,this.gotoTopupVisible2=!1},async requestSearch(){if(this.remain_credit<=0){this.creditZero();return}if(this.inputValue.length==0){h.warning("\u8BF7\u8F93\u5165\u5173\u952E\u8BCD");return}if(this.inputValue.length>7){h.warning("\u5173\u952E\u8BCD\u6700\u957F\u4E0D\u8D85\u8FC77\u4E2A\u5B57");return}var s=new RegExp("[\u4E00-\u9FA5A-Za-z0-9]+$","g");if(!s.test(this.inputValue)){h.warning("\u5173\u952E\u8BCD\u90FD\u4E0D\u542B\u6807\u70B9\u54E6");return}if(this.searching==!0)return;this.searching=!0,this.spinning=!0;let e=await this.api.search(this.inputValue);if(this.spinning=!1,this.searching=!1,!a.isEmpty(e))if(a.isEmpty(e.code))m.set("searchedCount",0),this.justFound=e.id,this.requestHomeAfter();else{let i=null;if(e.code=="e120")this.creditZero();else if(e.code=="e110")i="\u8BA2\u5355\u4E0D\u5B58\u5728",this.$router.push("/character");else if(e.code=="e100")i="\u6E38\u620F\u4E3B\u9898\u4E0D\u5B58\u5728";else if(e.code=="e130"){i="\u6C92\u627E\u5230\u76F8\u5173\u788E\u7247\uFF0C\u8BF7\u91CD\u65B0\u641C\u7D22";let o=m.get("searchedCount");o==null&&(o=0),o++,m.set("searchedCount",o),o>=5&&(i="\u5361\u4F4F\u4E86\uFF1F\u8054\u7CFB\u5BA2\u670D\u8981\u4E2A\u63D0\u793A\u5427\uFF01",m.set("searchedCount",0))}i&&h.warning(i),this.remain_credit==0||(this.remain_credit=this.remain_credit-1)}this.inputValue=""},updateUI:function(s){this.my_role.name=s.my_role.name,this.my_role.avatar=s.my_role.avatar;let e=s.other_roles,i="";for(var o=e.length-1;o>=0;o--)i=i+e[o].name+(o==0?"":"\uFF0C");this.my_role.crew=i,this.role_stats=s.role_stats,this.remain_credit=s.remain_credit,this.topic_links=s.topic_links,s.topic_links instanceof Array&&s.topic_links.length<3&&(this.topic_links.push({title:"",link_url:""}),this.topic_links.push({title:"",link_url:""}),this.topic_links.push({title:"",link_url:""})),this.dataLoaded=!0,this.isAuthorised=!0,this.justFound>0&&(document.getElementById(`cv${this.justFound}`).scrollIntoView(),h.warning("\u6210\u529F\u627E\u5230\u788E\u7247"),this.justFound=-1),this.updateDiscoveredList(s)},updateDiscoveredList(s){this.discoveredList=[];for(var e=0;e<s.role_stats.length;e++){let o=s.role_stats[e];for(var i=0;i<o.fragments.length;i++){let n=o.fragments[i];n.has_discovered==!0&&this.discoveredList.push(n.id)}}},handleHelp:function(s){window.location.href=this.topic_links[s].link_url},handleTopup:function(s){this.$router.push({path:"/topup"})},handleOk:function(){this.visible1=!1},handleCancel:function(){this.visible1=!0},handleUnlockOk(){this.isUnlocakModalVisible=!1,this.requestUnlockedPiece()},handleUnlockCancel(){this.isUnlocakModalVisible=!1},async requestHomeAfter(){const s=await this.api.home();!(s instanceof Error)&&!a.isEmpty(s)&&this.updateUI(s)}}},S=Object.assign(xt,{setup(s){return(e,i)=>{const o=v("a-spin"),n=v("a-modal");return c(),l("view",Se,[t("div",Le,[p(o,{spinning:e.spinning},null,8,["spinning"])]),e.isAuthorised?g("",!0):(c(),l("view",Pe,[t("text",{title:e.emptyTitle},null,8,Te)])),p(U,{homePage:!0}),p(n,{title:"",visible:e.isUnlocakModalVisible,onOk:e.handleUnlockOk,onCancel:e.handleUnlockCancel,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u89E3\u9501",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:$(()=>[t("view",Ve,[t("view",null,"\u8BE5\u8BB0\u5FC6\u788E\u7247\u5C1A\u672A\u89E3\u9501\uFF0C\u8981\u6D88\u8017"+u(e.unlockCredit)+"\u6B21\u641C\u7D22\u673A\u4F1A\u89E3\u9501\u5417\uFF1F",1)])]),_:1},8,["visible","onOk","onCancel"]),p(n,{title:"",visible:e.gotoTopupVisible,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:$(()=>[Ee]),_:1},8,["visible","onOk","onCancel"]),p(n,{title:"",visible:e.gotoTopupVisible2,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:$(()=>[Re]),_:1},8,["visible","onOk","onCancel"]),t("view",Ue,[t("view",qe,[t("text",null,u(e.book),1)]),e.dataLoaded?(c(),l("view",Be,[t("view",Fe,[t("view",{class:"btns",onClick:i[0]||(i[0]=r=>e.handleHelp(0))},[t("text",Oe,u(e.topic_links[0].title),1)]),t("view",{class:"btns",onClick:i[1]||(i[1]=r=>e.handleHelp(1))},[t("text",We,u(e.topic_links[1].title),1)]),t("view",{class:"btns",onClick:i[2]||(i[2]=r=>e.handleHelp(2))},[t("text",Ae,u(e.topic_links[2].title),1)])])])):g("",!0),e.dataLoaded?(c(),l("view",je,[t("img",{src:e.imgs.dot},null,8,Me)])):g("",!0),e.dataLoaded?(c(),l("view",ze,[t("view",He,[t("img",{src:e.my_role.avatar},null,8,Je)]),t("view",Ne,[t("view",Ge,"\u63A2\u5458\uFF1A"+u(e.my_role.name),1),t("view",De,"\u7EC4\u5458\uFF1A"+u(e.my_role.crew),1)])])):g("",!0),e.dataLoaded?(c(),l("view",Ze,[t("img",{src:e.imgs.dot},null,8,Ke)])):g("",!0)]),e.dataLoaded?(c(),l("view",Qe,[Ye,t("view",Xe,[t("view",et,[t("form",tt,[t("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u4F60\u60F3\u8981\u7684\u5185\u5BB9",value:e.inputValue,onInput:i[3]||(i[3]=r=>e.inputValue=r.target.value),onKeyup:i[4]||(i[4]=F((...r)=>e.requestSearch&&e.requestSearch(...r),["13"]))},null,40,st)])]),t("view",{class:"search-btn",onClick:i[5]||(i[5]=r=>e.requestSearch())},nt)]),t("view",ot,[t("view",rt,[t("text",at,"\u641C\u7D22\u5269\u4F59\u6B21\u6570\uFF1A"+u(e.remain_credit),1)]),t("view",{class:"topup",onClick:i[6]||(i[6]=(...r)=>e.handleTopup&&e.handleTopup(...r))},[t("img",{src:e.imgs.pay},null,8,ct),t("text",lt,u(e.payTitle),1)])]),t("view",dt,[t("img",{src:e.imgs.line,mode:"widthFix"},null,8,ht)])])):g("",!0),(c(!0),l(y,null,k(e.role_stats,r=>(c(),l("view",ut,[t("view",pt,[t("text",null,u(r.role),1)]),t("view",_t,[(c(!0),l(y,null,k(r.fragments,d=>(c(),l("view",{class:V(d.has_discovered?"item-box discovered":"item-box"),id:`cv${d.id}`},[d.has_discovered==!0?(c(),l("view",mt,[t("text",{animation:"{{animate[item.id]}}",onClick:f=>e.handlePieceTap(d.id),"data-cid":"item.id"},u(d.display_label),9,ft)])):(c(),l("view",vt,[t("text",{onClick:f=>e.handleUnlockedPieceTap(d.id,d.credit_to_unlock)},u(d.display_label),9,yt)]))],10,gt))),256))]),t("view",wt,[t("img",{src:e.imgs.line,mode:"widthFix"},null,8,kt)])]))),256)),t("div",$t,[t("p",null,u(b(R)),1)]),bt])}}});const It={class:"container"},Ct={class:"spin"},St=t("view",{style:{height:"40px"}},null,-1),Lt={class:"choose_character"},Pt=t("view",{class:"column"},[t("text",{class:"title2"},"\u767B\u5F55")],-1),Tt={class:"img-top-shortline"},Vt=["src"],Et={class:"login"},Rt=t("view",{class:"recordcell"},[t("view")],-1),Ut={class:"login-bar"},qt={class:"login-search"},Bt={class:"search-block",action:"javascript:void 0"},Ft=["value"],Ot={class:"login-row"},Wt={class:"login-search login-search1"},At={class:"search-block",action:"javascript:void 0"},jt=["value"],Mt=t("text",null,"\u83B7\u53D6\u9A8C\u8BC1\u7801",-1),zt=[Mt],Ht=t("text",{class:"login-sure-btn"},"\u786E\u5B9A",-1),Jt=[Ht],Nt={class:"login-version"},Gt={data(){return{inputValue:"",inputCode:"",phoneNumber:"",imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png"},spinning:!1,version:"v1.0.0"}},async mounted(){this.version=m.getVersion()},methods:{compositionUpdate:function(s){this.phoneNumber=s.data},getCode:async function(){if(this.inputValue.length==0){h.warning("\u8BF7\u8F93\u5165\u624B\u673A\u53F7");return}if(this.spinning){h.warning("\u6B63\u5728\u6536\u53D6\u9A8C\u8BC1\u7801\uFF0C\u8BF7\u7A0D\u7B49");return}this.spinning=!0;const e=await new _({}).getCode(this.inputValue);this.spinning=!1,e instanceof Error?h.error(e.message):a.isEmpty(e)||a.get(e,"status")=="ok"&&h.success("\u53D1\u9001\u6210\u529F")},phonenoLogin:async function(){if(this.inputCode.length==0){h.warning("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801");return}this.spinning=!0;const e=await new _({}).phonenoLogin(this.inputValue,this.inputCode);this.spinning=!1,a.isEmpty(e)||(a.get(e,"status")=="ok"?(h.success("\u767B\u5F55\u6210\u529F"),this.gotoHomePage()):h.error(e.message))},gotoHomePage:function(){this.$router.push("/home")}}},Dt=Object.assign(Gt,{setup(s){return(e,i)=>{const o=v("a-spin");return c(),l("view",It,[t("div",Ct,[p(o,{spinning:e.spinning},null,8,["spinning"])]),St,t("view",Lt,[Pt,t("view",Tt,[t("img",{src:e.imgs.shortLine,mode:"widthFix"},null,8,Vt)])]),t("view",Et,[Rt,t("view",Ut,[t("view",qt,[t("form",Bt,[t("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u4F60\u7684\u624B\u673A\u53F7",value:e.inputValue,onInput:i[0]||(i[0]=n=>e.inputValue=n.target.value)},null,40,Ft)])]),t("view",Ot,[t("view",Wt,[t("form",At,[t("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u624B\u673A\u9A8C\u8BC1\u7801",value:e.inputCode,onInput:i[1]||(i[1]=n=>e.inputCode=n.target.value)},null,40,jt)])]),t("view",{class:V(e.spinning?"get-code-text sending":"get-code-text"),onClick:i[2]||(i[2]=(...n)=>e.getCode&&e.getCode(...n))},zt,2)])])]),t("view",{class:"login-sure",onClick:i[3]||(i[3]=(...n)=>e.phonenoLogin&&e.phonenoLogin(...n))},Jt),t("div",Nt,[t("text",null,u(e.version),1)])])}}});const Zt={data(){return{search_text:"",content_type:1,display_id:"",role:"",comment:"",text:"",image:"",pictures:[""],imageSize:{},px2px:2,windowWidth:375,src:"",curTime:"00:00",endTime:"00:00",reCurTime:"",reEndTime:"",playurl:"",status:"",cdCls:"pause",currentDot:0,isplay:!1,timer:"",currentFragmentId:87,discoveredList:[],currentPieceIndex:0,last:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png",eye:"https://assets.storiesmatter.cn/eye.png",play:"https://assets.storiesmatter.cn/play1.png",pause:"https://assets.storiesmatter.cn/pause1.png"},imgWidth:375}},async mounted(){this.imgWidth=document.documentElement.clientWidth||document.body.clientWidth,a.isEmpty(this.$route.query)||(this.discoveredList=this.$route.query.discoveredList,this.currentPieceIndex=this.$route.query.index),this.gotoPiece();const s="width=device-width, initial-scale=1.0, user-scalable=yes";document.querySelector('meta[name="viewport"]').content=s},methods:{gotoMap(){},async requestFragment(){this.$toast.open({message:"\u6B63\u5728\u52A0\u8F7D...",duration:2e3,dismissible:!1});const e=await new _({}).fragments(this.currentFragmentId);e!=null&&(this.search_text=e.search_text,this.content_type=e.content_type,this.role=e.role_name,this.display_id=e.display_id,this.comment=e.comment,this.text=e.text,this.playurl=e.audio,this.image=e.image,this.pictures.push(e.image),this.playurl!=null&&this.content_type==3),this.$toast.clear()},gotoPiece(){this.onUnloadAudio(),this.currentFragmentId=this.discoveredList[this.currentPieceIndex],parseInt(this.currentPieceIndex)+1==this.discoveredList.length?this.last=!0:this.last=!1,this.currentFragmentId!=null&&(this.pictures=[],this.imageSize=[],this.requestFragment())},previous(){this.currentPieceIndex<=0||(this.currentPieceIndex--,this.gotoPiece())},next(){parseInt(this.currentPieceIndex)+1>=this.discoveredList.length||(this.currentPieceIndex++,this.gotoPiece())},onUnloadAudio(){clearInterval(this.timer)},onUnload(){this.onUnloadAudio()}}},Kt={class:"container"},Qt=t("view",{style:{height:"40px"}},null,-1),Yt={class:"choose_character"},Xt={class:"column"},es=["src"],ts=t("view",{style:{width:"10px"}},null,-1),ss={style:{"font-size":"18px"}},is={class:"img-top-shortline"},ns=["src"],os={class:"userinfobtns"},rs={class:"column"},as={class:"btn"},cs={class:"btn"},ls={class:"btn"},ds=["src"],hs={key:1,class:"sliderCont"},us=["src"],ps={key:2,class:"message"},_s=t("view",{style:{height:"100px"}},null,-1),gs={class:"bottom1"},ms={class:"column1"},fs={key:0},vs={key:1},ys=t("text",{decode:"{{true}}"},"\u4E0A\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),ws=[ys],ks={key:2},$s={key:3},bs=t("text",{decode:"{{true}}"},"\u4E0B\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),xs=[bs];function Is(s,e,i,o,n,r){return c(),l("view",Kt,[Qt,t("view",Yt,[t("view",Xt,[t("img",{style:{width:"30px",height:"15px","margin-top":"7px"},src:n.imgs.eye},null,8,es),ts,t("text",ss,u(n.search_text),1)]),t("view",is,[t("img",{src:n.imgs.shortLine,mode:"widthFix"},null,8,ns)])]),t("view",os,[t("view",rs,[t("view",as,[t("text",null,u(n.display_id),1)]),t("view",cs,[t("text",null,u(n.role),1)]),t("view",ls,[t("text",null,u(n.comment),1)])])]),n.content_type==2?(c(),l("view",{key:0,class:"fragment-img",onClick:e[0]||(e[0]=(...d)=>r.gotoMap&&r.gotoMap(...d))},[t("view",null,[t("img",{src:n.pictures[0],style:O({width:n.imgWidth+"px"}),mode:"scaleToFill"},null,12,ds)])])):g("",!0),n.content_type==3?(c(),l("view",hs,[t("audio",{src:n.playurl,controls:"",controlsList:"nodownload",class:"aaudio"},null,8,us)])):g("",!0),n.content_type==1?(c(),l("text",ps,u(n.text),1)):g("",!0),_s,t("view",gs,[t("view",ms,[n.currentPieceIndex==0?(c(),l("view",fs)):(c(),l("view",vs,[t("view",{class:"btn1",onClick:e[1]||(e[1]=(...d)=>r.previous&&r.previous(...d))},ws)])),n.last==!0?(c(),l("view",ks)):(c(),l("view",$s,[t("view",{class:"btn1",onClick:e[2]||(e[2]=(...d)=>r.next&&r.next(...d))},xs)]))])])])}var Cs=I(Zt,[["render",Is]]);const Ss={class:"container"},Ls={class:"spin"},Ps=t("view",{style:{height:"40px"}},null,-1),Ts={class:"choose_character"},Vs=t("view",{class:"column"},[t("text",{class:"title2"},"\u8D2D\u4E70\u641C\u7D22\u6B21\u6570")],-1),Es={class:"img-top-shortline"},Rs=["src"],Us={class:"statement-list"},qs=["onClick"],Bs=["value"],Fs={class:"cell-text"},Os=t("p",null,null,-1),Ws=t("p",null,null,-1),As=t("text",{class:"svg-demo-text"},"\u5FAE\u4FE1\u652F\u4ED8",-1),js=[As],Ms={class:"login-version"},zs={components:{},data(){return{pickedId:1,list:[],position:"left",disabled:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png"},imageSize:{},px2rpx:2,windowWidth:375,videoAd:null,inWechatBrowser:!1,api:null,spinning:!1,appId:"wx4cbaf7126c634959",uri:"",wcode:"",openid:"openid",version:"v1.0.0"}},onLoad(s){s.type!=null&&(this.type=s.type)},async mounted(){this.version=m.getVersion();var s=window.navigator.userAgent.toLowerCase();s.match(/MicroMessenger/i)=="micromessenger"?this.inWechatBrowser=!0:this.inWechatBrowser=!1,this.greet(),a.isEmpty(localStorage.pricingId)&&(localStorage.pricingId=1),a.isEmpty(localStorage.pricingPickedId)&&(localStorage.pricingPickedId=1),this.pickedId=localStorage.pricingPickedId;let e=new URL(location.href).origin+"/topup";const i=new URL(location.href).searchParams.get("code");a.isEmpty(i)||(this.wcode=i,this.handlePay()),this.uri=`https://open.weixin.qq.com/connect/oauth2/authorize?appid=${this.appId}&redirect_uri=`+e+"&response_type=code&scope=snsapi_base&state=STATE&connect_redirect=1#wechat_redirect"},computed:{},methods:{greet:async function(s){this.spinning=!0,this.api=new _({});const e=await this.api.pricing();this.spinning=!1,e==null||(this.list=e.results)},handleRadio(s,e){console.log("pricingId is",e),localStorage.pricingId=e,localStorage.pricingPickedId=s+1,this.pickedId=s+1},async handlePayGetCode(){window.location.href=this.uri},async handlePay(){this.inWechatBrowser||h.warning("\u8BF7\u5728\u5FAE\u4FE1\u91CC\u6253\u5F00\u5145\u503C\u9875\u9762\uFF0C\u6216\u8054\u7CFB\u5BA2\u670D\u54E6\uFF01"),this.spinning=!0;const s=this;typeof WeixinJSBridge=="undefined"?(console.log("WeixinJSBridge undefined"),document.addEventListener?(console.log("2"),document.addEventListener("WeixinJSBridgeReady",s.onBridgeReady,!1)):document.attachEvent&&(console.log("3"),document.attachEvent("WeixinJSBridgeReady",s.onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",s.onBridgeReady))):(console.log("WeixinJSBridge is defined"),this.onBridgeReady())},onBridgeReady(){console.log("------onBridgeReady this.wcode",this.wcode),h.info("\u6B63\u5728\u542F\u52A8\u5FAE\u4FE1\u652F\u4ED8"),this.api.orders(localStorage.pricingId,this.wcode).then(s=>{if(this.spinning=!1,s instanceof Error)s.message=="Request failed with status code 500"?h.error("\u8BF7\u5148\u5173\u6CE8\u516C\u4F17\u53F7\u3010\u6545\u610F\u4E8B\u52A1\u6240\u3011"):h.error(s.message),this.$router.push({path:"/topup"});else if(!a.isEmpty(s))if(s.status==="ok"){const{appId:e=this.appId,timeStamp:i,nonceStr:o,paySign:n}=s,r="MD5",d=s.package;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e,timeStamp:i,nonceStr:o,package:d,signType:r,paySign:n},function(f){console.log("res",f),f.err_msg=="get_brand_wcpay_request:ok"?h.success("\u652F\u4ED8\u6210\u529F"):h.error("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8"),this.$router.push("/home")})}else h.error("\u8BA2\u5355\u8FD4\u56DE\u9519\u8BEF"),this.$router.push("/home")})}}},Hs=Object.assign(zs,{setup(s){return(e,i)=>{const o=v("a-spin");return c(),l("view",Ss,[t("div",Ls,[p(o,{spinning:e.spinning},null,8,["spinning"])]),p(U,{homePage:!1}),Ps,t("view",Ts,[Vs,t("view",Es,[t("img",{src:e.imgs.shortLine,mode:"widthFix"},null,8,Rs)])]),t("view",Us,[(c(!0),l(y,null,k(e.list,(n,r)=>(c(),l("view",{key:r,index:"index",item:"item"},[t("view",{class:"cell",onClick:d=>e.handleRadio(r,n.id)},[L(t("input",{class:"cell-radio",type:"radio",value:n.id,"onUpdate:modelValue":i[0]||(i[0]=d=>T(pickedId)?pickedId.value=d:null)},null,8,Bs),[[P,e.pickedId]]),t("text",Fs,u(n.credit)+"\u6B21\u641C\u7D22 \xA5"+u(n.price),1),Os],8,qs)]))),128))]),Ws,t("view",{class:"pay",onClick:i[1]||(i[1]=(...n)=>e.handlePayGetCode&&e.handlePayGetCode(...n))},js),t("div",Ms,[t("p",null,u(e.version),1),t("p",null,u(b(R)),1)])])}}});const Js={},Ns={class:"container"},Gs=t("text",{class:"svg-demo-text"},"Page not found",-1),Ds=[Gs];function Zs(s,e,i,o,n,r){return c(),l("view",Ns,Ds)}var Ks=I(Js,[["render",Zs]]);const Qs=W({history:A("/"),routes:[{path:"/home",name:"home",component:S},{path:"/character",name:"character",component:$e},{path:"/piece",component:Cs},{path:"/login",component:Dt},{path:"/topup",component:Hs},{path:"/",component:S},{path:"/:pathMatch(.*)*",component:Ks}]});const w=j(G);w.use(Qs);w.use(M,{position:"top"});w.use(z);w.use(H);w.mount("#app");
