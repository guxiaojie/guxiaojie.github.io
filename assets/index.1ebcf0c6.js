import{_ as d,a as L,o as l,c as O,u as A,R as M,b as c,d as o,t as h,e as C,r as V,f as v,F as x,g as I,m as u,w as S,v as q,i as E,h as _,j as T,k as W,l as F,n as J,p as z,q as G,s as j,x as H,y as D,z as N,V as Z,A as K,B as Q}from"./vendor.2da6f5ce.js";const X=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}};X();let B="";B="https://www.storiesmatter.cn";class m{constructor(e){this.storyId=1,console.log("localStorage.storyId",localStorage.storyId),!d.isEmpty(localStorage.storyId)&&localStorage.storyId!=="null"&&(this.storyId=localStorage.storyId,console.log("localStorage.storyId",localStorage.storyId)),this.config=e,this.config.baseURL=B+"/api",this.token()}token(){var e="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjQ5MDc0MTEzLCJqdGkiOiJkZjI0MWY3NGUzMDA0NWQ5ODEyZTViZWQzYTk5NWIwYiIsInVzZXJfaWQiOjF9.BMA9VKU8ewI6V9Sr9DRTkZ3s3eJHQvSG72GvqhL-brA";e="Bearer ",e+=localStorage.token,this.axios=L.create({baseURL:this.config.baseURL}),this.axios.defaults.headers.common.Authorization=e}async roles(){const e=await this.axios.get(`topics/${this.storyId}/roles/`);return console.log("roles response",e),e.data}async home(){try{const e=await this.axios.get(`topics/${this.storyId}/home/`);return console.log("response",e),e.data}catch(e){return console.log("home error: "+e+e.response.data),console.log(e.response.data),console.log("home error: ",e instanceof Error),e}}async initGame(e){try{const t=await this.axios.post(`topics/${this.storyId}/init-game/`,{role_id:e});return console.log("initGame response",t),t.data}catch(t){return console.log("initGame error: ",t),console.log("initGame error: ",t.response.data),t}}async fragments(e){const t=await this.axios.get(`fragments/${e}/`);return console.log("response",t),t.data}async search(e){try{const t=await this.axios.get(`topics/${this.storyId}/fragments/?q=${e}`);return console.log("response",t),t.data}catch(t){return console.log("response mserrorerrorg",t),null}}async unlock(e){const t=await this.axios.post(`topics/${this.storyId}/fragments/${e}/unlock/`);return console.log("response",t),t.data}async pricing(){const e=await this.axios.get(`topics/${this.storyId}/pricing/`);return console.log("response",e),e.data}async getCode(e){try{const t=await this.axios.post("phoneno-get-code/",{phone_no:e});return console.log("response",t),t.data}catch(t){return console.log("response mserrorerrorg",t),null}}async phonenoLogin(e,t){try{const i=await this.axios.post("phoneno-login/",{phone_no:e,user_input_code:t});return console.log("response",i),localStorage.token=d.get(i.data,"access"),localStorage.refresh=d.get(i.data,"refresh"),i.data}catch(i){console.log("response mserrorerrorg",i),console.log(i.response.data);const n=d.get(i.response.data,"non_field_errors"),r=d.get(i.response.data,"user_input_code");if(d.isEmpty(n)){if(!d.isEmpty(r))return i.message=r[0],i}else return i.message=n[0],i;return i}}async tokenVerify(){try{const e=await this.axios.post("token/verify/",{token:localStorage.token});return console.log("verify token response",e),!0}catch(e){if(console.log("response mserrorerrorg",e),d.isEmpty(localStorage.refresh))return!1;{const i=await new m({}).tokenRefresh();return console.log("tokenRefresh",i),i}}}async tokenRefresh(){try{const e=await this.axios.post("token/refresh/",{refresh:localStorage.refresh});return console.log("refresh response",e),d.isEmpty(e.data)?!1:(localStorage.token=d.get(e.data,"access"),!0)}catch(e){return console.log("tokenRefresh",e),!1}}async login(){const e={avatar_url:"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6pjAcqAwjE9l9Yc8bex4lrJ2PFE9rnJXvM0oSicxW8liadwT46J3pOMdHJ1scGR2jHiaEnVHWqcdYMA/132",city:"",country:"",gender:0,js_code:"091gvxGa1ypdMC0tOrJa1cOmJQ1gvxG3",language:"zh_CN",nick_name:"\u8C37\u6653\u6D01Sage",province:""},t=[],i="";if(i.length>0)for(const p of i)t.push(p.route);const n="",r={method:"POST",url:this.config.baseURL+"/simple-wechat-login/",headers:{Authorization:n,"Content-Type":"application/json"},data:e};return console.log("------options",r),(await L(r)).data}handleAxiosError(e){console.log("response err",e),console.log("response err",e.msg)}handleUnexpectedError(e){this.handleAxiosError(e)}async orders(e){try{const{data:t,statusCode:i,msg:n}=await this.axios.post(`topics/${this.storyId}/orders/`,{pricing_id:e});return console.log("response data",t),t}catch(t){console.log("response mserrorerrorg",t),L.isAxiosError(t)?this.handleAxiosError(t):this.handleUnexpectedError(t)}}}var f={get:function(s){return console.log("---set get",s,localStorage.getItem(s)),localStorage.getItem(s)||null},set:function(s,e){localStorage.setItem(s,e)},gotoHomeOrRole:function(s){const e=JSON.parse(localStorage.getItem("storyCharacters"));console.log("---gotoHomeOrRole",e,e[localStorage.storyId]),d.isEmpty(e)||d.isEmpty(e[localStorage.storyId])||e[localStorage.storyId]==0?s.$router.push("/character"):s.$router.push("/login")},setRole:function(s){const e="storyCharacters",t=JSON.parse(localStorage.getItem(e))||{};t[localStorage.storyId]=s,localStorage.setItem(e,JSON.stringify(t))}};const Y={computed:{username(){return this.$route.params.username}},async mounted(){const s=new URL(location.href).searchParams.get("storyId");d.isEmpty(s)||(localStorage.storyId=s),d.isEmpty(localStorage.storyId)&&(localStorage.storyId=1),this.goToDashboard()},methods:{goToDashboard:async function(){if(d.isEmpty(localStorage.token))this.$router.push("/login");else{f.gotoHomeOrRole(this);const e=await new m({}).tokenVerify();console.log("tokenVerify",e),e||this.$router.push("/login")}}}},U=Object.assign(Y,{setup(s){return(e,t)=>(l(),O(A(M)))}}),ee=async(s,e,t,i={},n)=>{if(i.cacheKey){const p=te();if(p)return p}const r=[],a="";if(a.length>0)for(const p of a)r.push(p.route)},te=s=>{const e="";return(new Date().getTime()-Number.parseInt(e.createTime))/1e3>86400?!1:e.value};var y={doRequest:ee};const se=2;let b="";b="https://www.storiesmatter.cn";var w={host:b,url:b+"/api",check_openid:b+"/api/check_openid",env:se,mapKey:""};const oe=async(s,e,t={})=>await y.doRequest(`${w.url}/${s}`,"GET",e,t),ie=async(s,e,t={})=>await y.doRequest(`${w.url}/${s}`,"PUT",e,t),ne=async(s,e,t={})=>await y.doRequest(`${w.url}/${s}`,"Post",e,t),re=async(s,e,t={})=>await y.doRequest(`${w.url}/${s}`,"DELETE",e,t),ae=async(s,e={})=>await y.wxUpload(`${w.url}/upload`,s,e),le=(s,e,t={},i)=>y.doRequest(`${w.url}/${s}`,"GET",e,t,i),ce=(s,e,t={},i)=>y.doRequest(`${w.url}/${s}`,"Post",e,t,i),de=(s,e,t={},i)=>y.doRequest(s,"GET",e,t,i),he=(s,e,t={},i)=>y.doRequest(s,"Post",e,t,i),ue=(s,e,t)=>{wx.request({url:`${w.host}/${s}`,success:i=>t(i)})};var P={Get:oe,Put:ie,Post:ne,Destroy:re,PostBasic:ce,GetBasic:le,WX:ue,Upload:ae,GetWeixintBasic:de,PostWeixintBasic:he};var R=(s,e)=>{const t=s.__vccOpts||s;for(const[i,n]of e)t[i]=n;return t};const pe={props:{statement:Object},methods:{statementEvent:function(s,e){console.log("----------",s,e),this.$emit("submit",s,e)}}},ge={class:"information"},me={class:"icon"},_e=["src"],fe={class:"st-title"},ye={class:"title"},we=C(),ve=o("span",null,"\xA0\xA0\xA0 ",-1),ke={class:"time"};function $e(s,e,t,i,n,r){return l(),c("view",{class:"charactercell",onClick:e[0]||(e[0]=a=>r.statementEvent(t.statement.id))},[o("view",ge,[o("view",me,[o("img",{class:"icon-img",src:t.statement.avatar},null,8,_e)]),o("view",fe,[o("view",ye,h(t.statement.name),1),we,ve,o("view",ke,h(t.statement.brief_text),1)])])])}var xe=R(pe,[["render",$e]]);const be={class:"container"},Ie={class:"spin"},Ce=o("view",{style:{height:"20px"}},null,-1),Se={class:"choose_character"},Le=o("view",{class:"column"},[o("text",{class:"title"},"\u9009\u62E9\u4F60\u7684\u8EAB\u4EFD")],-1),Te={class:"img-top-shortline"},Pe=["src"],Ve={class:"character-statement-list"},Ee=["onClick"],Re=["value"],qe=o("view",{style:{height:"30px"}},null,-1),We={class:"character-bottom"},Be=o("text",{style:{"font-size":"20px",color:"white"}},"\u5F00\u59CB\u8C03\u67E5",-1),Ue=[Be],Oe=o("view",null,[o("text",{style:{float:"right","margin-right":"10px","font-size":"12px",color:"#757575"}},"*\u63A2\u5458\u8EAB\u4EFD\u4E00\u65E6\u786E\u5B9A\uFF0C\u4E0D\u53EF\u66F4\u6539")],-1),Ae=o("view",{style:{height:"50px"}},null,-1),Me={components:{},data(){return{spinning:!1,pickedId:1,roleId:1,imgs:{shortline:"https://assets.storiesmatter.cn/shortline.png"},list:[]}},async mounted(){const e=await new m({}).roles();this.list=e.results},methods:{submit:function(s,e){console.log("---sumit in parent",s,e)},handleInquiry:async function(){this.spinning=!0;const e=await new m({}).initGame(this.roleId);this.spinning=!1,d.isEmpty(e)||(e.code=="e160"?u.success("\u53D1\u73B0\u5377\u5B97\uFF0C\u7EE7\u7EED\u8C03\u67E5"):f.setRoles(this.roleId),this.$router.push("/home"))},handleRadio(s,e){console.log("index",s,e),this.roleId=e,this.pickedId=s+1}}},Fe=Object.assign(Me,{setup(s){return(e,t)=>{const i=V("a-spin");return l(),c(x,null,[o("view",be,[o("div",Ie,[v(i,{spinning:e.spinning},null,8,["spinning"])]),Ce,o("view",Se,[Le,o("view",Te,[o("img",{src:e.imgs.shortline,mode:"widthFix"},null,8,Pe)])]),o("view",Ve,[(l(!0),c(x,null,I(e.list,(n,r)=>(l(),c("view",{key:r,index:"index",item:"item"},[o("view",{class:"character-cell",onClick:a=>e.handleRadio(r,n.id)},[S(o("input",{class:"character-cell-radio",type:"radio",value:n.id,"onUpdate:modelValue":t[0]||(t[0]=a=>E(pickedId)?pickedId.value=a:null)},null,8,Re),[[q,e.pickedId]]),v(xe,{class:"cell-text",statement:n,onSubmit:e.submit},null,8,["statement","onSubmit"])],8,Ee)]))),128))])]),qe,o("view",We,[o("view",{class:"character-btn",onClick:t[1]||(t[1]=(...n)=>e.handleInquiry&&e.handleInquiry(...n))},Ue)]),Oe,Ae],64)}}});const Je={class:"container"},ze={class:"spin"},Ge={key:0},je=["title"],He=o("text",null,[o("span",null,"\xA0\xA0\xA0"),C(" \u5BA2\u670D\u5FAE\u4FE1\u8BF7\u6DFB\u52A015711067100 ")],-1),De=o("text",{class:"copy"},[C(" \u4E00\u952E\u590D\u5236\u8D26\u53F7 "),o("span",null,"\xA0\xA0\xA0")],-1),Ne=[He,De],Ze={style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},Ke=o("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[o("view",null,"\u641C\u7D22\u6B21\u6570\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u89E3\u9501\u8BB0\u5FC6\u788E\u7247")],-1),Qe=o("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[o("view",null,"\u641C\u7D22\u6B21\u6570\u5DF2\u7ECF\u7528\u5B8C\uFF0C\u8BF7\u5148\u5145\u503C\uFF01")],-1),Xe={class:"header"},Ye={class:"level-1"},et={key:0,class:"top-btns"},tt={class:"column1"},st={class:"btn1"},ot={class:"btn1"},it={class:"btn1"},nt={key:1,class:"dotline"},rt=["src"],at={key:2,class:"userinfo"},lt={class:"icon"},ct=["src"],dt={class:"st-title"},ht={class:"first-line"},ut={class:"time"},pt={key:3,class:"dotline"},gt=["src"],mt={key:1,class:"searchcell",id:"searchit"},_t=o("view",{class:"recordcell"},[o("view",null,[o("text",{class:"btn1"},"\u8C03\u67E5\u8BB0\u5F55")])],-1),ft={class:"searchbar"},yt={class:"search"},wt={class:"search-block",action:"javascript:void 0"},vt={class:"search-btn"},kt=["src"],$t={class:"paycell"},xt={class:"paycell-title"},bt={class:"btn1"},It=["src"],Ct={class:"btn1"},St={class:"longline"},Lt=["src"],Tt={class:"fragment-content",id:"fragmentContent","wx:key":"index"},Pt={class:"fragment-title"},Vt={class:"container-box"},Et=["id"],Rt={key:0},qt=["onClick"],Wt={key:1},Bt=["onClick"],Ut={class:"longline"},Ot=["src"],At=o("view",{style:{height:"60px"}},null,-1),Mt={data(){return{book:"\u6545\u610F\u4E8B\u52A1\u6240\u63A2\u5458\u7CFB\u7EDF",payTitle:"\u8D2D\u4E70\u6B21\u6570",emptyTitle:"",role_stats:[],topic_links:[],my_role:{id:"4",name:"",crew:"",icon_path:"",avatar:""},remain_credit:0,userInfo:!0,dataLoaded:!1,currentTotal:"",submiting:!1,inputValue:"",showAuthorise:!1,isAuthorised:!1,characterId:0,focusSearchInput:!1,justFound:-1,searchScrollTop:286,searching:!1,visible1:!1,isUnlocakModalVisible:!1,gotoTopupVisible:!1,gotoTopupVisible2:!1,isIntroVisible:!1,unlockCredit:0,unlockFragmentId:0,animate:[],windowHeight:750,discoveredList:[],onboard:!1,inWechatBrowser:!1,imageSize:{},px2rpx:2,windowWidth:375,count:1,imgs:{help:"https://assets.storiesmatter.cn/help.png?1",eye:"https://assets.storiesmatter.cn/eye-top.png?2",tick:"https://assets.storiesmatter.cn/tick.png?1",crew:"https://assets.storiesmatter.cn/icon-crew.png",hospital:"https://assets.storiesmatter.cn/icon-hospital.png",delegate:"https://assets.storiesmatter.cn/icon-delegate.png",dot:"https://assets.storiesmatter.cn/dotline.png",search:"https://assets.storiesmatter.cn/search-button.png",pay:"https://assets.storiesmatter.cn/icon-pay.png",line:"https://assets.storiesmatter.cn/longline.png",intromodal:"https://assets.storiesmatter.cn/intromodal.png"},api:null,spinning:!1}},computed:{username(){return this.$route.params.username}},async mounted(){this.spinning=!0,this.api=new m({});const s=await this.api.home();if(this.spinning=!1,s instanceof Error)d.get(s.response.data,"code");else if(!d.isEmpty(s)){this.updateUI(s),this.discoveredList=[];for(var e=0;e<s.role_stats.length;e++){let r=s.role_stats[e];for(var t=0;t<r.fragments.length;t++){let a=r.fragments[t];a.has_discovered==!0&&this.discoveredList.push(a.id)}}}var i=window.navigator.userAgent.toLowerCase();i.match(/MicroMessenger/i)=="micromessenger"?this.inWechatBrowser=!0:this.inWechatBrowser=!1,this.inWechatBrowser=!0;const n="width=device-width, initial-scale=1.0, user-scalable=no";document.querySelector('meta[name="viewport"]').content=n},methods:{handlePieceTap:function(s){let e=this.discoveredList.indexOf(s);e!=null&&(console.log("--- this.discoveredList",this.discoveredList),this.$router.push({path:"/piece",query:{id:s,index:e,discoveredList:this.discoveredList}}))},handleUnlockedPieceTap:function(s,e){console.log("---fragmentId",s,e),this.unlockFragmentId=s,this.isUnlocakModalVisible=!0,this.unlockCredit=e},onClick:function(){this.requestUnlockedPiece()},onDismiss:function(){this.$toast.clear()},creditZero:function(){this.inWechatBrowser?this.gotoTopupVisible2=!0:u.warning("\u641C\u7D22\u6B21\u6570\u5DF2\u7528\u5B8C\uFF0C\u8BF7\u5148\u8054\u7CFB\u5BA2\u670D\u54E6\uFF01")},async requestUnlockedPiece(){this.spinning=!0;const s=await this.api.unlock(this.unlockFragmentId);this.spinning=!1,s!=null?s.code=="e190"||s.code=="e120"?this.inWechatBrowser?this.gotoTopupVisible=!0:this.copy():s.code==null&&(this.justFound=s.id,this.getChanllengeList()):u.error("\u89E3\u9501\u8BB0\u5FC6\u788E\u7247\u5931\u8D25")},handleGotoTopup:function(){this.gotoTopupVisible=!1,this.$router.push({path:"/topup"})},handleCancelTopup:function(){this.gotoTopupVisible=!1,this.gotoTopupVisible2=!1},async requestSearch(){if(console.log("---requestSearch",this.inputValue,this.remain_credit),this.remain_credit<=0){this.creditZero();return}if(this.inputValue.length==0){u.warning("\u8BF7\u8F93\u5165\u5173\u952E\u8BCD");return}if(this.inputValue.length>7){u.warning("\u5173\u952E\u8BCD\u6700\u957F\u4E0D\u8D85\u8FC77\u4E2A\u5B57");return}var s=new RegExp("[\u4E00-\u9FA5A-Za-z0-9]+$","g");if(!s.test(this.inputValue)){u.warning("\u5173\u952E\u8BCD\u90FD\u4E0D\u542B\u6807\u70B9\u54E6");return}if(this.searching==!0)return;this.searching=!0,this.spinning=!0;const e=await this.api.search(this.inputValue);if(this.spinning=!1,this.searching=!1,!d.isEmpty(e))if(d.isEmpty(e.code))f.set("searchedCount",0),this.justFound=e.id,this.getChanllengeList();else{this.focusSearchInput=!0,this.focusSearchInput=!1;let t=null;if(e.code=="e120")this.creditZero(),this.focusSearchInput=!1;else if(e.code=="e110")t="\u8BA2\u5355\u4E0D\u5B58\u5728";else if(e.code=="e100")t="\u6E38\u620F\u4E3B\u9898\u4E0D\u5B58\u5728";else if(e.code=="e130"){t="\u6C92\u627E\u5230\u76F8\u5173\u788E\u7247\uFF0C\u8BF7\u91CD\u65B0\u641C\u7D22";let i=f.get("searchedCount");i==null&&(i=0),i++,f.set("searchedCount",i),i>=5&&(t="\u5361\u4F4F\u4E86\uFF1F\u8054\u7CFB\u5BA2\u670D\u8981\u4E2A\u63D0\u793A\u5427\uFF01",f.set("searchedCount",0))}t&&u.warning(t),this.remain_credit==0||(this.remain_credit=this.remain_credit-1)}this.inputValue=""},updateUI:function(s){this.my_role.name=s.my_role.name,this.my_role.avatar=s.my_role.avatar;let e=s.other_roles,t="";for(var i=e.length-1;i>=0;i--)t=t+e[i].name+(i==0?"":"\uFF0C");this.my_role.crew=t,this.role_stats=s.role_stats,this.remain_credit=s.remain_credit,this.topic_links=s.topic_links,this.topic_links.length<3&&(this.topic_links.push({title:"",link_url:""}),this.topic_links.push({title:"",link_url:""})),f.setRole(this.my_role.id),this.dataLoaded=!0,this.isAuthorised=!0,this.justFound>0&&(u.warning("\u6210\u529F\u627E\u5230\u788E\u7247"),this.justFound=-1)},handleHelp:function(s){window.location.href=this.topic_links[s].link_url},handleTopup:function(s){this.$router.push({path:"/topup"})},copy:function(s){this.$copyText("15711067100").then(function(e){alert("Copied"),console.log(e)},function(e){alert("Can not copy"),console.log(e)})},handleOk:function(){this.visible1=!1},handleCancel:function(){this.visible1=!0},handleUnlockOk(){this.isUnlocakModalVisible=!1,this.requestUnlockedPiece()},handleUnlockCancel(){this.isUnlocakModalVisible=!1},async getChanllengeList(){const s=await this.api.home();if(console.log("home data: ",s instanceof Error),!(s instanceof Error)&&!d.isEmpty(s)){this.updateUI(s),this.discoveredList=[];for(var e=0;e<s.role_stats.length;e++){let i=s.role_stats[e];for(var t=0;t<i.fragments.length;t++){let n=i.fragments[t];n.has_discovered==!0&&this.discoveredList.push(n.id)}}}}}},Ft=Object.assign(Mt,{setup(s){return(e,t)=>{const i=V("a-spin"),n=V("a-modal");return l(),c("view",Je,[o("div",ze,[v(i,{spinning:e.spinning},null,8,["spinning"])]),e.isAuthorised?_("",!0):(l(),c("view",Ge,[o("text",{title:e.emptyTitle},null,8,je)])),o("view",{class:"systemprompt",onClick:t[0]||(t[0]=(...r)=>e.copy&&e.copy(...r))},Ne),v(n,{title:"",visible:e.isUnlocakModalVisible,onOk:e.handleUnlockOk,onCancel:e.handleUnlockCancel,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u89E3\u9501",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:T(()=>[o("view",Ze,[o("view",null,"\u8BE5\u8BB0\u5FC6\u788E\u7247\u5C1A\u672A\u89E3\u9501\uFF0C\u8981\u6D88\u8017"+h(e.unlockCredit)+"\u6B21\u641C\u7D22\u673A\u4F1A\u89E3\u9501\u5417\uFF1F",1)])]),_:1},8,["visible","onOk","onCancel"]),v(n,{title:"",visible:e.gotoTopupVisible,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:T(()=>[Ke]),_:1},8,["visible","onOk","onCancel"]),v(n,{title:"",visible:e.gotoTopupVisible2,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:T(()=>[Qe]),_:1},8,["visible","onOk","onCancel"]),o("view",Xe,[o("view",Ye,[o("text",null,h(e.book),1)]),e.dataLoaded?(l(),c("view",et,[o("view",tt,[o("view",{class:"btns",onClick:t[1]||(t[1]=r=>e.handleHelp(0))},[o("text",st,h(e.topic_links[0].title),1)]),o("view",{class:"btns",onClick:t[2]||(t[2]=r=>e.handleHelp(1))},[o("text",ot,h(e.topic_links[1].title),1)]),o("view",{class:"btns",onClick:t[3]||(t[3]=r=>e.handleHelp(2))},[o("text",it,h(e.topic_links[2].title),1)])])])):_("",!0),e.dataLoaded?(l(),c("view",nt,[o("img",{src:e.imgs.dot},null,8,rt)])):_("",!0),e.dataLoaded?(l(),c("view",at,[o("view",lt,[o("img",{src:e.my_role.avatar},null,8,ct)]),o("view",dt,[o("view",ht,"\u63A2\u5458\uFF1A"+h(e.my_role.name),1),o("view",ut,"\u7EC4\u5458\uFF1A"+h(e.my_role.crew),1)])])):_("",!0),e.dataLoaded?(l(),c("view",pt,[o("img",{src:e.imgs.dot},null,8,gt)])):_("",!0)]),e.dataLoaded?(l(),c("view",mt,[_t,o("view",ft,[o("view",yt,[o("form",wt,[S(o("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u4F60\u60F3\u8981\u7684\u5185\u5BB9","onUpdate:modelValue":t[4]||(t[4]=r=>E(inputValue)?inputValue.value=r:null),onKeyup:t[5]||(t[5]=F((...r)=>e.requestSearch&&e.requestSearch(...r),["13"]))},null,544),[[W,e.inputValue]])])]),o("view",vt,[o("img",{src:e.imgs.search,onClick:t[6]||(t[6]=r=>e.requestSearch())},null,8,kt)])]),o("view",$t,[o("view",xt,[o("text",bt,"\u641C\u7D22\u5269\u4F59\u6B21\u6570\uFF1A"+h(e.remain_credit),1)]),o("view",{class:"topup",onClick:t[7]||(t[7]=(...r)=>e.handleTopup&&e.handleTopup(...r))},[o("img",{src:e.imgs.pay},null,8,It),o("text",Ct,h(e.payTitle),1)])]),o("view",St,[o("img",{src:e.imgs.line,mode:"widthFix"},null,8,Lt)])])):_("",!0),(l(!0),c(x,null,I(e.role_stats,r=>(l(),c("view",Tt,[o("view",Pt,[o("text",null,h(r.role),1)]),o("view",Vt,[(l(!0),c(x,null,I(r.fragments,a=>(l(),c("view",{class:J(a.has_discovered?"item-box discovered":"item-box"),id:a.id},[a.has_discovered==!0?(l(),c("view",Rt,[o("text",{animation:"{{animate[item.id]}}",onClick:p=>e.handlePieceTap(a.id),"data-cid":"item.id"},h(a.display_label),9,qt)])):(l(),c("view",Wt,[o("text",{onClick:p=>e.handleUnlockedPieceTap(a.id,a.credit_to_unlock)},h(a.display_label),9,Bt)]))],10,Et))),256))]),o("view",Ut,[o("img",{src:e.imgs.line,mode:"widthFix"},null,8,Ot)])]))),256)),At])}}});const Jt={class:"container"},zt=o("view",{style:{height:"40px"}},null,-1),Gt={class:"choose_character"},jt=o("view",{class:"column"},[o("text",{class:"title2"},"\u767B\u5F55")],-1),Ht={class:"img-top-shortline"},Dt=["src"],Nt={class:"login"},Zt=o("view",{class:"recordcell"},[o("view")],-1),Kt={class:"login-bar"},Qt={class:"login-search"},Xt={class:"search-block",action:"javascript:void 0"},Yt={class:"login-row"},es={class:"login-search login-search1"},ts={class:"search-block",action:"javascript:void 0"},ss=["value"],os=o("text",null,"\u83B7\u53D6\u9A8C\u8BC1\u7801",-1),is=[os],ns=o("text",{class:"login-sure-btn"},"\u786E\u5B9A",-1),rs=[ns],as={data(){return{inputValue:"18810440803",inputCode:"",imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png"}}},methods:{getCode:async function(){if(this.inputValue.length==0){u.warning("\u8BF7\u8F93\u5165\u624B\u673A\u53F7");return}const e=await new m({}).getCode(this.inputValue);d.isEmpty(e)||d.get(e,"status")=="ok"&&u.success("\u53D1\u9001\u6210\u529F")},phonenoLogin:async function(){if(this.inputCode.length==0){u.warning("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801");return}const e=await new m({}).phonenoLogin(this.inputValue,this.inputCode);d.isEmpty(e)||(d.get(e,"status")=="ok"?(u.success("\u767B\u5F55\u6210\u529F"),this.gotoHomePage()):u.error(e.message))},gotoHomePage:function(){const s=JSON.parse(localStorage.getItem("storyCharacters"));d.isEmpty(s)||s[localStorage.storyId]==0?this.$router.push("/character"):this.$router.push("/home")}}},ls=Object.assign(as,{setup(s){return(e,t)=>(l(),c("view",Jt,[zt,o("view",Gt,[jt,o("view",Ht,[o("img",{src:e.imgs.shortLine,mode:"widthFix"},null,8,Dt)])]),o("view",Nt,[Zt,o("view",Kt,[o("view",Qt,[C(h(e.inputValue)+" "+h(e.inputCode)+" ",1),o("form",Xt,[S(o("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u4F60\u7684\u624B\u673A\u53F7","onUpdate:modelValue":t[0]||(t[0]=i=>E(inputValue)?inputValue.value=i:null)},null,512),[[W,e.inputValue]])])]),o("view",Yt,[o("view",es,[o("form",ts,[o("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u624B\u673A\u9A8C\u8BC1\u7801",value:e.inputCode},null,8,ss)])]),o("view",{class:"get-code",onClick:t[1]||(t[1]=(...i)=>e.getCode&&e.getCode(...i))},is)])])]),o("view",{class:"login-sure",onClick:t[2]||(t[2]=(...i)=>e.phonenoLogin&&e.phonenoLogin(...i))},rs)]))}});const cs={data(){return{search_text:"",content_type:1,display_id:"",role:"",comment:"",text:"",image:"",pictures:[""],imageSize:{},px2px:2,windowWidth:375,src:"",curTime:"00:00",endTime:"00:00",reCurTime:"",reEndTime:"",playurl:"",status:"",cdCls:"pause",currentDot:0,isplay:!1,timer:"",currentFragmentId:87,discoveredList:[],currentPieceIndex:0,last:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png",eye:"https://assets.storiesmatter.cn/eye.png",play:"https://assets.storiesmatter.cn/play1.png",pause:"https://assets.storiesmatter.cn/pause1.png"},imgWidth:375}},async mounted(){console.log("imgWidth",this.imgWidth),console.log(this.$route.query),this.imgWidth=(document.documentElement.clientWidth||document.body.clientWidth)-20,console.log("imgWidth",this.imgWidth),d.isEmpty(this.$route.query)||(this.discoveredList=this.$route.query.discoveredList,this.currentPieceIndex=this.$route.query.index),this.gotoPiece();const s="width=device-width, initial-scale=1.0, user-scalable=yes";document.querySelector('meta[name="viewport"]').content=s},methods:{gotoMap(){},async requestFragment(){this.$toast.open({message:"\u6B63\u5728\u52A0\u8F7D...",duration:2e3,dismissible:!1});const e=await new m({}).fragments(this.currentFragmentId);e!=null&&(this.search_text=e.search_text,this.content_type=e.content_type,this.role=e.role_name,this.display_id=e.display_id,this.comment=e.comment,this.text=e.text,this.playurl=e.audio,this.image=e.image,this.pictures.push(e.image),this.playurl!=null&&this.content_type==3),this.$toast.clear()},gotoPiece(){this.onUnloadAudio(),this.currentFragmentId=this.discoveredList[this.currentPieceIndex],parseInt(this.currentPieceIndex)+1==this.discoveredList.length?this.last=!0:this.last=!1,console.log("this.currentFragmentId",this.currentFragmentId),this.currentFragmentId!=null&&(this.pictures=[],this.imageSize=[],this.requestFragment())},previous(){this.currentPieceIndex<=0||(this.currentPieceIndex--,this.gotoPiece())},next(){parseInt(this.currentPieceIndex)+1>=this.discoveredList.length||(this.currentPieceIndex++,this.gotoPiece())},onUnloadAudio(){clearInterval(this.timer)},onUnload(){this.onUnloadAudio()}}},ds={class:"container"},hs=o("view",{style:{height:"40px"}},null,-1),us={class:"choose_character"},ps={class:"column"},gs=["src"],ms=o("view",{style:{width:"10px"}},null,-1),_s={style:{"font-size":"18px"}},fs={class:"img-top-shortline"},ys=["src"],ws={class:"userinfobtns"},vs={class:"column"},ks={class:"btn"},$s={class:"btn"},xs={class:"btn"},bs=["src"],Is={key:1,class:"sliderCont"},Cs=["src"],Ss={key:2,class:"message"},Ls=o("view",{style:{height:"100px"}},null,-1),Ts={class:"bottom1"},Ps={class:"column1"},Vs={key:0},Es={key:1},Rs=o("text",{decode:"{{true}}"},"\u4E0A\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),qs=[Rs],Ws={key:2},Bs={key:3},Us=o("text",{decode:"{{true}}"},"\u4E0B\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),Os=[Us];function As(s,e,t,i,n,r){return l(),c("view",ds,[hs,o("view",us,[o("view",ps,[o("img",{style:{width:"30px",height:"15px","margin-top":"7px"},src:n.imgs.eye},null,8,gs),ms,o("text",_s,h(n.search_text),1)]),o("view",fs,[o("img",{src:n.imgs.shortLine,mode:"widthFix"},null,8,ys)])]),o("view",ws,[o("view",vs,[o("view",ks,[o("text",null,h(n.display_id),1)]),o("view",$s,[o("text",null,h(n.role),1)]),o("view",xs,[o("text",null,h(n.comment),1)])])]),n.content_type==2?(l(),c("view",{key:0,class:"fragment-img",onClick:e[0]||(e[0]=(...a)=>r.gotoMap&&r.gotoMap(...a))},[o("view",null,[o("img",{src:n.pictures[0],style:z({width:n.imgWidth+"px"}),mode:"scaleToFill"},null,12,bs)])])):_("",!0),n.content_type==3?(l(),c("view",Is,[o("audio",{src:n.playurl,controls:"controls",class:"aaudio"},null,8,Cs)])):_("",!0),n.content_type==1?(l(),c("text",Ss,h(n.text),1)):_("",!0),Ls,o("view",Ts,[o("view",Ps,[n.currentPieceIndex==0?(l(),c("view",Vs)):(l(),c("view",Es,[o("view",{class:"btn1",onClick:e[1]||(e[1]=(...a)=>r.previous&&r.previous(...a))},qs)])),n.last==!0?(l(),c("view",Ws)):(l(),c("view",Bs,[o("view",{class:"btn1",onClick:e[2]||(e[2]=(...a)=>r.next&&r.next(...a))},Os)]))])])])}var Ms=R(cs,[["render",As]]);class g{constructor(e){this.isLoading=!1,this.that=e.that}static form(e){return{message:e,type:"info",duration:1e3,dismissible:!1,queue:!1,position:"top"}}static success(e,t=500){if(setTimeout(()=>{wx.showToast({title:e,icon:"success",mask:!0,duration:t})},300),t>0)return new Promise((i,n)=>{setTimeout(()=>{i()},t)})}static confirm(e,t={},i="\u63D0\u793A"){return new Promise((n,r)=>{wx.showModal({title:i,content:e,showCancel:!0,success:a=>{a.confirm?n(t):a.cancel&&r(t)},fail:a=>{r(t)}})})}static toast(e,t="success"){const i={message:e,type:"info",duration:1e3,dismissible:!0,queue:!1,position:"top"};that.$toast.open(i)}static alert(e){wx.showToast({title:e,icon:"/public/images/error.png",mask:!0,duration:1500})}static error(e,t=1500){wx.showToast({title:e,icon:"none",mask:!1,duration:t})}static loading(e,t){if(g.isLoading)return;g.isLoading=!0;const i={message:"\u52A0\u8F7D\u4E2D...",type:"info",duration:1e4,dismissible:!1,queue:!1,position:"bottom-right",onClick:this.onClick,onDismiss:this.onDismiss};t.$toast.open(i)}static loaded(e){g.isLoading&&(g.isLoading=!1,e.$toast.clear())}static share(e,t,i){return{title:e,path:t,desc:i,success:function(n){g.toast("\u5206\u4EAB\u6210\u529F")}}}}g.isLoading=!1;const Fs={components:{},data(){return{pickedId:1,list:[],currentid:"1",position:"left",disabled:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png"},imageSize:{},px2rpx:2,windowWidth:375,videoAd:null,inWechatBrowser:!1}},onLoad(s){s.type!=null&&(this.type=s.type)},mounted(){var s=window.navigator.userAgent.toLowerCase();s.match(/MicroMessenger/i)=="micromessenger"?this.inWechatBrowser=!0:this.inWechatBrowser=!1,this.greet()},computed:{},methods:{greet:async function(s){g.loading(null,this);const t=await new m({}).pricing();t==null||(this.list=t.results,f.set("pricing",t.results)),g.loaded(this)},redirect_url(s){wx.navigateTo({url:`/pages/categories/child?id=${s}&type=${this.type}`})},handleFruitChange({detail:s={}}){this.current=s.value},handleRadio(s,e){console.log("index",s,e),this.currentid=e,this.pickedId=s+1},radioChange({detail:s={}}){this.currentid=s.value},async handlePay(){console.log("sssss"),g.loading(null,this),await new m({}).orders(1,1);const e=await P.Post("topics/1/orders/",{pricing_id:this.currentid});e==null||(console.log(e),e.status=="ok"&&wx.requestPayment({timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign,success:function(t){console.log("PAID!!"),wx.navigateBack({delta:1})},fail:function(t){console.log("\u652F\u4ED8\u5931\u6557")},complete:function(t){console.log("\u652F\u4ED8\u5B8C\u6210")}})),g.loaded()},async handlePay1(){if(console.log("handlePay1"),!this.inWechatBrowser){u.warning("\u8BF7\u5728\u5FAE\u4FE1\u91CC\u6253\u5F00\u5145\u503C\u9875\u9762\uFF0C\u6216\u8054\u7CFB\u5BA2\u670D\u54E6\uFF01");return}const s=this;typeof WeixinJSBridge=="undefined"?(console.log("WeixinJSBridge undefined"),document.addEventListener?(console.log("2"),document.addEventListener("WeixinJSBridgeReady",s.onBridgeReady,!1)):document.attachEvent&&(console.log("3"),document.attachEvent("WeixinJSBridgeReady",s.onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",s.onBridgeReady))):(console.log("WeixinJSBridge is defined"),this.onBridgeReady()),this.onBridgeReady()},onBridgeReady(){new m({}).orders(this.currentid).then(e=>{if(!d.isEmpty(e)&&e.status==="ok"){const{appId:t="wx1f692d7b9b57066d",timeStamp:i,nonceStr:n,paySign:r}=e,a="MD5",p=e.package;console.log("nonceStr",n),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t,timeStamp:i,nonceStr:n,package:p,signType:a,paySign:r},function($){console.log("res",$),$.err_msg=="get_brand_wcpay_request:ok"?console.log("\u652F\u4ED8\u6210\u529F"):console.log("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8")})}})},imageLoad(s){const e=s.detail.width*this.px2rpx,t=s.detail.height*this.px2rpx,i=e/t;let n=750,r;e>=n?r=n/i:(n=e,r=t);const a=this.imageSize;a[s.target.dataset.index]={width:n,height:r},this.imageSize=a},gotoMap(){const s=this.pictures[0]+"?"+Math.random()/9999;wx.previewImage({current:s,urls:[s],success:function(e){},fail:function(e){},complete:function(e){}})},loadAds(){this.videoAd?this.videoAd.show().catch(()=>{this.videoAd.load().then(()=>{this.videoAd.show()}).catch(s=>{console.log("\u6FC0\u52B1\u89C6\u9891 \u5E7F\u544A\u663E\u793A\u5931\u8D25")})}):wx.showModal({title:"\u8B66\u544A",content:"\u53EF\u89C2\u770B\u6FC0\u52B1\u5F0F\u89C6\u9891\u5E7F\u544A\u7684\u6B21\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C \u8BF7\u7A0D\u540E\u91CD\u8BD5",showCancel:!1,success:function(s){}})}},async requestPricing(){g.loading("\u52A0\u8F7D\u4E2D...");const s=await P.Get("topics/1/pricing/");s==null||(this.list=s.results,f.set("pricing",s.results)),g.loaded()},async requestCredit(){const s=await P.Get("topics/1/ads-credit/");s!=null&&wx.showModal({title:"",content:s.added_credit+"\u6B21\u641C\u7D22\u6B21\u6570\u5DF2\u5230\u8D26",showCancel:!1,success:function(e){}})}},Js={class:"container"},zs=o("view",{style:{height:"40px"}},null,-1),Gs={class:"choose_character"},js=o("view",{class:"column"},[o("text",{class:"title1"},"\u8D2D\u4E70\u641C\u7D22\u6B21\u6570")],-1),Hs={class:"img-top-shortline"},Ds=["src"],Ns={class:"statement-list"},Zs=["onClick"],Ks=["value"],Qs={class:"cell-text"},Xs=o("p",null,null,-1),Ys=o("text",{class:"svg-demo-text"},"\u5FAE\u4FE1\u652F\u4ED8",-1),eo=[Ys];function to(s,e,t,i,n,r){return l(),c("view",Js,[zs,o("view",Gs,[js,o("view",Hs,[o("img",{src:n.imgs.shortLine,mode:"widthFix"},null,8,Ds)])]),o("view",Ns,[(l(!0),c(x,null,I(n.list,(a,p)=>(l(),c("view",{key:p,index:"index",item:"item"},[o("view",{class:"cell",onClick:$=>r.handleRadio(p,a.id)},[S(o("input",{class:"cell-radio",type:"radio",value:a.id,"onUpdate:modelValue":e[0]||(e[0]=$=>n.pickedId=$)},null,8,Ks),[[q,n.pickedId]]),o("text",Qs,h(a.credit)+"\u6B21\u641C\u7D22 \xA5"+h(a.price),1),Xs],8,Zs)]))),128))]),o("view",{class:"pay",onClick:e[1]||(e[1]=(...a)=>r.handlePay1&&r.handlePay1(...a))},eo)])}var so=R(Fs,[["render",to]]);const oo=G({history:j("/present-vue/"),routes:[{path:"/home",name:"home",component:Ft},{path:"/character",name:"character",component:Fe},{path:"/piece",component:Ms},{path:"/login",component:ls},{path:"/topup",component:so},{path:"/",component:U}]});const io=H({state(){return{count:0}},mutations:{increment(s){s.count++}},modules:{toast:D({dismissInterval:8e3})}}),k=N(U);k.use(oo);k.use(io);k.use(Z,{position:"top"});k.use(K);k.use(Q);k.mount("#app");
