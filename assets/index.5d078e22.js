import{a as P,o as l,c as y,u as F,R as N,b as h,d as t,t as d,F as I,r as T,e as f,w as m,_ as S,m as $,f as w,g,h as R,v as J,i as D,n as j,j as G,k as H,l as Z,p as K,q as Q,s as X,x as Y,V as ee,y as te,A as se}from"./vendor.c37ff122.js";const ie=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}};ie();let U="";U="https://www.storiesmatter.cn";class b{constructor(e){this.storyId=1,this.config=e,this.config.baseURL=U+"/api",this.token()}token(){const e="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjQ5MDc0MTEzLCJqdGkiOiJkZjI0MWY3NGUzMDA0NWQ5ODEyZTViZWQzYTk5NWIwYiIsInVzZXJfaWQiOjF9.BMA9VKU8ewI6V9Sr9DRTkZ3s3eJHQvSG72GvqhL-brA";this.axios=P.create({baseURL:this.config.baseURL}),this.axios.defaults.headers.common.Authorization=e}async roles(){const e=await this.axios.get(`topics/${this.storyId}/roles/`);return console.log("response",e),e.data}async home(){const e=await this.axios.get(`topics/${this.storyId}/home/`);return console.log("response",e),e.data}async fragments(e){const s=await this.axios.get(`fragments/${e}/`);return console.log("response",s),s.data}async home(){const e=await this.axios.get(`topics/${this.storyId}/home/`);return console.log("response",e),e.data}async unlock(e){const s=await this.axios.post(`topics/${this.storyId}/fragments/${e}/unlock/`);return console.log("response",s),s.data}async pricing(){const e=await this.axios.get(`topics/${this.storyId}/pricing/`);return console.log("response",e),e.data}async login(){const e={avatar_url:"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6pjAcqAwjE9l9Yc8bex4lrJ2PFE9rnJXvM0oSicxW8liadwT46J3pOMdHJ1scGR2jHiaEnVHWqcdYMA/132",city:"",country:"",gender:0,js_code:"091gvxGa1ypdMC0tOrJa1cOmJQ1gvxG3",language:"zh_CN",nick_name:"\u8C37\u6653\u6D01Sage",province:""},s=[],n="";if(n.length>0)for(const c of n)s.push(c.route);const o="",a={method:"POST",url:this.config.baseURL+"/simple-wechat-login/",headers:{Authorization:o,"Content-Type":"application/json"},data:e};return console.log("------options",a),(await P(a)).data}handleAxiosError(e){console.log("response err",e),console.log("response err",e.msg)}handleUnexpectedError(e){this.handleAxiosError(e)}async orders(e){try{const{data:s,statusCode:n,msg:o}=await this.axios.post(`topics/${this.storyId}/orders/`,{pricing_id:e});return console.log("response data",s),s}catch(s){console.log("response mserrorerrorg",s),P.isAxiosError(s)?this.handleAxiosError(s):this.handleUnexpectedError(s)}}}const oe={computed:{username(){return this.$route.params.username}},mounted(){this.goToDashboard()},methods:{goToDashboard(){this.$router.push("/home")}}},ne=Object.assign(oe,{setup(i){return(e,s)=>(l(),y(F(N)))}}),ae="modulepreload",V={},re="/present-vue/",ce=function(e,s){return!s||s.length===0?e():Promise.all(s.map(n=>{if(n=`${re}${n}`,n in V)return;V[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${a}`))return;const r=document.createElement("link");if(r.rel=o?"stylesheet":ae,o||(r.as="script",r.crossOrigin=""),r.href=n,document.head.appendChild(r),o)return new Promise((c,u)=>{r.addEventListener("load",c),r.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())},le=async(i,e,s,n={},o)=>{if(n.cacheKey){const c=de();if(c)return c}const a=[],r="";if(r.length>0)for(const c of r)a.push(c.route)},de=i=>{const e="";return(new Date().getTime()-Number.parseInt(e.createTime))/1e3>86400?!1:e.value};var _={doRequest:le};const ue=2;let C="";C="https://www.storiesmatter.cn";var v={host:C,url:C+"/api",check_openid:C+"/api/check_openid",env:ue,mapKey:""};const he=async(i,e,s={})=>await _.doRequest(`${v.url}/${i}`,"GET",e,s),pe=async(i,e,s={})=>await _.doRequest(`${v.url}/${i}`,"PUT",e,s),me=async(i,e,s={})=>await _.doRequest(`${v.url}/${i}`,"Post",e,s),ge=async(i,e,s={})=>await _.doRequest(`${v.url}/${i}`,"DELETE",e,s),_e=async(i,e={})=>await _.wxUpload(`${v.url}/upload`,i,e),fe=(i,e,s={},n)=>_.doRequest(`${v.url}/${i}`,"GET",e,s,n),ye=(i,e,s={},n)=>_.doRequest(`${v.url}/${i}`,"Post",e,s,n),we=(i,e,s={},n)=>_.doRequest(i,"GET",e,s,n),ve=(i,e,s={},n)=>_.doRequest(i,"Post",e,s,n),be=(i,e,s)=>{wx.request({url:`${v.host}/${i}`,success:n=>s(n)})};var q={Get:he,Put:pe,Post:me,Destroy:ge,PostBasic:ye,GetBasic:fe,WX:be,Upload:_e,GetWeixintBasic:we,PostWeixintBasic:ve};const xe={category:{statementExpendList:"@category_statement_expend@",statementIncomeList:"@category_statement_income@",expendList:"@category_expend_list@",incomeList:"@category_income_list@"},asset:{statementAssets:"@asset_statement@",list:"@asset_list@"},alreadyLogin:"@alreadyLogin@",login:"weapp_login_session",bgImageKey:"@user_index_bg@",errorKey:"@request_error@",localStatementKey:"@local_statement_cache@"};var W={key:xe,get:function(i){return null},set:function(i,e){}};class p{constructor(e){this.isLoading=!1,this.that=e.that}static form(e){return{message:e,type:"info",duration:1e3,dismissible:!1,queue:!1,position:"top"}}static success(e,s=500){if(setTimeout(()=>{wx.showToast({title:e,icon:"success",mask:!0,duration:s})},300),s>0)return new Promise((n,o)=>{setTimeout(()=>{n()},s)})}static confirm(e,s={},n="\u63D0\u793A"){return new Promise((o,a)=>{wx.showModal({title:n,content:e,showCancel:!0,success:r=>{r.confirm?o(s):r.cancel&&a(s)},fail:r=>{a(s)}})})}static toast(e,s="success"){const n={message:e,type:"info",duration:1e3,dismissible:!0,queue:!1,position:"top"};that.$toast.open(n)}static alert(e){wx.showToast({title:e,icon:"/public/images/error.png",mask:!0,duration:1500})}static error(e,s=1500){wx.showToast({title:e,icon:"none",mask:!1,duration:s})}static loading(e,s){if(p.isLoading)return;p.isLoading=!0;const n={message:"\u52A0\u8F7D\u4E2D...",type:"info",duration:1e4,dismissible:!1,queue:!1,position:"bottom-right",onClick:this.onClick,onDismiss:this.onDismiss};s.$toast.open(n)}static loaded(e){p.isLoading&&(p.isLoading=!1,e.$toast.clear())}static share(e,s,n){return{title:e,path:s,desc:n,success:function(o){p.toast("\u5206\u4EAB\u6210\u529F")}}}}p.isLoading=!1;var L=(i,e)=>{const s=i.__vccOpts||i;for(const[n,o]of e)s[n]=o;return s};const ke={props:{statement:Object},methods:{statementEvent:function(i,e){console.log("----------",i,e),this.$emit("submit",i,e)}}},$e={class:"information"},Ce={class:"icon"},Ie=["src"],Te={class:"st-title"},Se={class:"title"},Le={class:"time"};function Pe(i,e,s,n,o,a){return l(),h("view",{class:"charactercell",onClick:e[0]||(e[0]=r=>a.statementEvent(s.statement.id))},[t("view",$e,[t("view",Ce,[t("img",{src:s.statement.avatar},null,8,Ie)]),t("view",Te,[t("view",Se,d(s.statement.id)+":"+d(s.statement.name),1),t("view",Le,d(s.statement.brief_text),1)])])])}var qe=L(ke,[["render",Pe]]);const Ee={class:"container"},Ae=t("view",{class:"choose_character"},[t("view",{class:"column"},[t("text",{class:"title"},"\u9009\u62E9\u4F60\u7684\u8EAB\u4EFD")]),t("view",{class:"img"},[t("image",{src:"https://assets.storiesmatter.cn/shortline.png",mode:"widthFix"})])],-1),Ve={class:"statement-list"},We={index:"index",item:"item"},Fe={class:"cell"},Re=t("view",{style:{height:"30px"}},null,-1),Ue={style:{width:"100%",height:"120px",display:"flex","justify-content":"center","align-items":"center"}},Be=t("text",{style:{"font-size":"40px",color:"white"}},"\u5F00\u59CB\u8C03\u67E5",-1),ze=[Be],Me=t("view",{class:"choose_character"},[t("view",{class:"column"},[t("text",{style:{"font-size":"24px",color:"#757575","margin-top":"-30px"}},"*\u63A2\u5458\u8EAB\u4EFD\u4E00\u65E6\u786E\u5B9A\uFF0C\u4E0D\u53EF\u66F4\u6539")])],-1),Oe=t("view",{style:{height:"50px"}},null,-1),Ne={components:{},data(){return{list:[{id:1,name:"b",text:"t",brief_text:"brief_text1"},{id:2,name:"c",brief_text:"brief_text2"},{id:3,name:"d",brief_text:"brief_text3"}]}},async mounted(){const e=await new b({}).roles();console.log("--",e),console.log("--",e.results),this.list=e.results},methods:{submit:function(i,e){console.log("---sumit in parent",i,e)},handleInquiry:function(){this.$router.push("/home")}}},Je=Object.assign(Ne,{setup(i){return(e,s)=>(l(),h("main",null,[t("view",Ee,[Ae,t("view",Ve,[(l(!0),h(I,null,T(e.list,n=>(l(),h("view",We,[t("view",Fe,[f(qe,{statement:n,onSubmit:e.submit},null,8,["statement","onSubmit"])])]))),256))])]),Re,t("view",Ue,[t("view",{style:{width:"320px",height:"120px",display:"flex","justify-content":"center","align-items":"center"},class:"btn",onClick:s[0]||(s[0]=(...n)=>e.handleInquiry&&e.handleInquiry(...n))},ze)]),Me,Oe]))}});const De={class:"container"},je={key:0},Ge={decode:"{{message}}"},He=t("span",null,"\xA0\xA0\xA0 ",-1),Ze=t("text",{class:"copy"},"\u4E00\u952E\u590D\u5236\u8D26\u53F7",-1),Ke={style:{}},Qe={class:"wrap",style:{}},Xe=["src"],Ye={style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},et=t("view",{style:{"margin-left":"40rpx","margin-right":"40rpx","text-align":"left"}},[t("view",null,"\u641C\u7D22\u6B21\u6570\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u89E3\u9501\u8BB0\u5FC6\u788E\u7247")],-1),tt={class:"header"},st={class:"level-1"},it={key:0,class:"top-btns"},ot={class:"column"},nt=["src"],at={class:"btn1"},rt=["src"],ct={class:"btn1"},lt=["src"],dt={class:"btn1"},ut={key:1,class:"dotline"},ht=["src"],pt={key:2,class:"userinfo"},mt={class:"icon"},gt=["src"],_t={class:"st-title"},ft={class:"first-line"},yt={class:"time"},wt={key:3,class:"dotline"},vt=["src"],bt={key:1,class:"searchcell",id:"searchit"},xt=t("view",{class:"recordcell"},[t("view",{class:"title1"},[t("text",{class:"btn1"},"\u8C03\u67E5\u8BB0\u5F55")])],-1),kt={class:"searchbar"},$t={class:"search"},Ct={class:"search-btn"},It=["src"],Tt={class:"paycell"},St={class:"paycell-title"},Lt={class:"btn1"},Pt=["src"],qt={class:"btn1"},Et={class:"longline"},At=["src"],Vt={class:"fragment-content",id:"fragmentContent","wx:key":"index"},Wt={class:"fragment-title"},Ft={class:"container-box"},Rt=["onClick"],Ut=["onClick"],Bt={class:"longline"},zt=["src"],Mt=t("view",{style:{height:"60px"}},null,-1),Ot={data(){return{message:"\u5BA2\u670D\u5FAE\u4FE1\u8BF7\u6DFB\u52A015711067100",book:"\u6545\u610F\u4E8B\u52A1\u6240\u63A2\u5458\u7CFB\u7EDF",payTitle:"\u8D2D\u4E70\u6B21\u6570",emptyTitle:"",role_stats:[],my_role:{id:"4",name:"",crew:"",icon_path:"",avatar:""},buttons:[{title:"\u89C4\u5219\u73A9\u6CD5",src:"http://mp.weixin.qq.com/s?__biz=MzIwNTg1NzU0NA==&mid=100005155&idx=1&sn=29b13f3fdfcaed03d202a1f897ef7639&chksm=172b2344205caa523efa40e1da70ac1643a605de2c5a1b6cdefebf5d9a511f9cb97849b2a97c#rd"},{title:"\u7EBF\u7D22\u8109\u7EDC",src:"http://mp.weixin.qq.com/s?__biz=MzIwNTg1NzU0NA==&mid=100005204&idx=1&sn=734fd67be72420de1a1aa575f3a780ab&chksm=172b2333205caa25d894c68bd564507325ac57d99f14c47eae01bb7084cb6cc13a28007428bd#rd"},{title:"\u63D0\u4EA4\u62A5\u544A",src:"http://mp.weixin.qq.com/s?__biz=MzIwNTg1NzU0NA==&mid=100005201&idx=1&sn=83556cc41002cfd3ecbcfee2681b63ec&chksm=172b2336205caa20f3abeaa662fb6367cc0ba2a3e45b361b4db042e2cd3b703311f10fc8ea3f#rd"},{title:"\u59D4\u6258\u4FE1\u606F",src:"https://mp.weixin.qq.com/s?__biz=MzIwNTg1NzU0NA==&mid=100005152&idx=1&sn=95fb303f7cd5ba55819bb935785b8aea&chksm=172b2347205caa5175ddd120c217028a9c680da0067316d4cf3dbd559b26101f9979432b1f88#rd"}],remain_credit:0,userInfo:!0,dataLoaded:!1,currentTotal:"",submiting:!1,inputValue:"",showAuthorise:!1,isAuthorised:!1,characterId:0,focusSearchInput:!1,justFound:-1,searchScrollTop:286,searching:!1,visible1:!1,isUnlocakModalVisible:!1,gotoTopupVisible:!1,isIntroVisible:!1,unlockCredit:0,unlockFragmentId:0,animate:[],windowHeight:750,discoveredList:[],onboard:!1,inWechatBrowser:!1,imageSize:{},px2rpx:2,windowWidth:375,count:1,imgs:{help:"https://assets.storiesmatter.cn/help.png?1",eye:"https://assets.storiesmatter.cn/eye-top.png?2",tick:"https://assets.storiesmatter.cn/tick.png?1",crew:"https://assets.storiesmatter.cn/icon-crew.png",hospital:"https://assets.storiesmatter.cn/icon-hospital.png",delegate:"https://assets.storiesmatter.cn/icon-delegate.png",dot:"https://assets.storiesmatter.cn/dotline.png",search:"https://assets.storiesmatter.cn/search-button.png",pay:"https://assets.storiesmatter.cn/icon-pay.png",line:"https://assets.storiesmatter.cn/longline.png",intromodal:"https://assets.storiesmatter.cn/intromodal.png"},api:null,spinning:!1}},computed:{username(){return this.$route.params.username}},async mounted(){this.api=new b({});const i=await this.api.home();if(!S.isEmpty(i)){this.updateUI(i),this.discoveredList=[];for(var e=0;e<i.role_stats.length;e++){let n=i.role_stats[e];for(var s=0;s<n.fragments.length;s++){let o=n.fragments[s];o.has_discovered==!0&&this.discoveredList.push(o.id)}}}},methods:{handlePieceTap:function(i){let e=this.discoveredList.indexOf(i);e!=null&&(console.log("--- this.discoveredList",this.discoveredList),this.$router.push({path:"/piece",query:{id:i,index:e,discoveredList:this.discoveredList}}))},handleUnlockedPieceTap:function(i,e){console.log("---fragmentId",i,e),this.unlockFragmentId=i,this.isUnlocakModalVisible=!0,this.unlockCredit=e},onClick:function(){this.requestUnlockedPiece()},onDismiss:function(){this.$toast.clear()},async requestUnlockedPiece(){this.spinning=!0;const i=await this.api.unlock(this.unlockFragmentId);this.spinning=!1,i!=null?i.code=="e190"||i.code=="e120"?this.inWechatBrowser?this.gotoTopupVisible=!0:this.copy():i.code==null&&(this.justFound=i.id,this.getChanllengeList()):$.error("\u89E3\u9501\u8BB0\u5FC6\u788E\u7247\u5931\u8D25")},handleGotoTopup:function(){this.gotoTopupVisible=!1,this.$router.push({path:"/topup"})},handleCancelTopup:function(){this.gotoTopupVisible=!0},async requestSearch(){if(console.log("---requestSearch"),this.remain_credit<=0){this.creditZero();return}if(this.inputValue.length==0){$.warning("\u8BF7\u8F93\u5165\u5173\u952E\u8BCD");return}if(this.inputValue.length>7){$.warning("\u5173\u952E\u8BCD\u6700\u957F\u4E0D\u8D85\u8FC77\u4E2A\u5B57");return}var i=new RegExp("[\u4E00-\u9FA5A-Za-z0-9]+$","g");if(!i.test(this.inputValue)){$.warning("\u5173\u952E\u8BCD\u90FD\u4E0D\u542B\u6807\u70B9\u54E6");return}if(this.searching==!0)return;this.searching=!0,p.loading("\u6B63\u5728\u641C\u7D22...");const e={q:this.inputValue};var s=this;const n=await wxRequest.GetBasic("topics/1/fragments/",e,{},function(a){p.loaded();let r=null;a.code=="e120"?(s.creditZero(),s.focusSearchInput=!1,s.$apply()):(a.code="e110")?r="\u8BA2\u5355\u4E0D\u5B58\u5728":(a.code="e100")&&(r="\u6E38\u620F\u4E3B\u9898\u4E0D\u5B58\u5728"),r&&wx.showToast({title:r,icon:"none",duration:3e3})});if(this.searching=!1,p.loaded(),n!=null)if(n.code!=null){this.focusSearchInput=!0,this.focusSearchInput=!1;let o;if(n.code=="e130"){o="\u6C92\u627E\u5230\u76F8\u5173\u788E\u7247\uFF0C\u8BF7\u91CD\u65B0\u641C\u7D22";let a=Session.get("searchedCount");a==null&&(a=0),a++,Session.set("searchedCount",a),a>=5&&(o="\u5361\u4F4F\u4E86\uFF1F\u8054\u7CFB\u5BA2\u670D\u8981\u4E2A\u63D0\u793A\u5427\uFF01",Session.set("searchedCount",0))}o&&wx.showToast({title:o,icon:"none",duration:3e3}),this.remain_credit==0||(this.remain_credit=this.remain_credit-1)}else Session.set("searchedCount",0),this.justFound=n.id,this.getChanllengeList();this.inputValue=""},updateUI:function(i){this.my_role.name=i.my_role.name,this.my_role.avatar=i.my_role.avatar;let e=i.other_roles,s="";for(var n=e.length-1;n>=0;n--)s=s+e[n].name+(n==0?"":"\uFF0C");if(this.my_role.crew=s,this.role_stats=i.role_stats,this.remain_credit=i.remain_credit,this.dataLoaded=!0,this.isAuthorised=!0,this.justFound>0){wx.showToast({title:"\u6210\u529F\u627E\u5230\u788E\u7247",icon:"success",duration:3e3});var o="#item"+this.justFound,a=wx.createSelectorQuery();a.select(o).boundingClientRect(),a.selectViewport().scrollOffset(),a.exec(function(c){let u=c[0].top+c[1].scrollTop-200;wx.pageScrollTo({scrollTop:u,duration:50})});var r=wx.createAnimation({duration:200,timingFunction:"ease",delay:300});r.opacity(.8).scale(1.15).step().opacity(1).scale(1).step(),this.animate[this.justFound]=r.export(),this.animate[this.justFound]="",this.justFound=-1}},handleHelp:function(i){},handleTopup:function(i){this.$router.push({path:"/topup"})},copy:function(i){this.$copyText("15711067100").then(function(e){alert("Copied"),console.log(e)},function(e){alert("Can not copy"),console.log(e)})},handleOk:function(){this.visible1=!1},handleCancel:function(){this.visible1=!0},handleUnlockOk(){this.isUnlocakModalVisible=!1,this.requestUnlockedPiece()},handleUnlockCancel(){this.isUnlocakModalVisible=!1},async getChanllengeList(){const i=this.api.home();if(!S.isEmpty(i)){this.updateUI(i),this.discoveredList=[];for(var e=0;e<i.role_stats.length;e++){let n=i.role_stats[e];for(var s=0;s<n.fragments.length;s++){let o=n.fragments[s];o.has_discovered==!0&&this.discoveredList.push(o.id)}}}}}},Nt=Object.assign(Ot,{setup(i){return(e,s)=>{const n=w("empty"),o=w("a-modal"),a=w("block"),r=w("a-spin");return l(),h("view",De,[f(r,{spinning:e.spinning,delay:e.delayTime},{default:m(()=>[e.isAuthorised?g("",!0):(l(),h("view",je,[f(n,{title:e.emptyTitle},null,8,["title"])])),t("view",{class:"systemprompt",onClick:s[0]||(s[0]=(...c)=>e.copy&&e.copy(...c))},[t("text",Ge,d(F($)),1),He,Ze]),f(o,{title:"",visible:e.isIntroVisible,onOk:e.handleIntroOk,"show-cancel":"{{false}}"},{default:m(()=>[t("view",Ke,[t("view",Qe,[t("img",{src:e.imgs.intromodal,style:{width:"{{imageSize[index].width}}rpx",height:"{{imageSize[index].height}}rpx"},"data-index":"{{index}}",mode:"scaleToFill",bindload:"imageLoad"},null,8,Xe)])])]),_:1},8,["visible","onOk"]),f(o,{title:"",visible:e.isUnlocakModalVisible,onOk:e.handleUnlockOk,onCancel:e.handleUnlockCancel,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u89E3\u9501",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:m(()=>[t("view",Ye,[t("view",null,"\u8BE5\u8BB0\u5FC6\u788E\u7247\u5C1A\u672A\u89E3\u9501\uFF0C\u8981\u6D88\u8017"+d(e.unlockCredit)+"\u6B21\u641C\u7D22\u673A\u4F1A\u89E3\u9501\u5417\uFF1F",1)])]),_:1},8,["visible","onOk","onCancel"]),f(o,{title:"",visible:e.gotoTopupVisible,onOk:e.handleGotoTopup,onCancel:e.handleCancelTopup,"show-cancel":"{{ true }}",okText:"\u7ACB\u5373\u5145\u503C",cancelText:"\u7EE7\u7EED\u8C03\u67E5"},{default:m(()=>[et]),_:1},8,["visible","onOk","onCancel"]),t("view",tt,[t("view",st,[t("text",null,d(e.book),1)]),e.dataLoaded?(l(),h("view",it,[t("view",ot,[t("view",{class:"btn crew",onClick:s[1]||(s[1]=c=>e.handleHelp(0))},[t("img",{src:e.imgs.help},null,8,nt),t("text",at,d(e.buttons[0].title),1)]),t("view",{class:"btn hospital",onClick:s[2]||(s[2]=c=>e.handleHelp(1))},[t("img",{src:e.imgs.eye},null,8,rt),t("text",ct,d(e.buttons[1].title),1)]),t("view",{class:"btn delegate",onClick:s[3]||(s[3]=c=>e.handleHelp(2))},[t("img",{src:e.imgs.tick},null,8,lt),t("text",dt,d(e.buttons[2].title),1)])])])):g("",!0),e.dataLoaded?(l(),h("view",ut,[t("img",{src:e.imgs.dot},null,8,ht)])):g("",!0),e.dataLoaded?(l(),h("view",pt,[t("view",mt,[t("img",{src:e.my_role.avatar},null,8,gt)]),t("view",_t,[t("view",ft,"\u63A2\u5458\uFF1A"+d(e.my_role.name),1),t("view",yt,"\u7EC4\u5458\uFF1A"+d(e.my_role.crew),1)])])):g("",!0),e.dataLoaded?(l(),h("view",wt,[t("img",{src:e.imgs.dot},null,8,vt)])):g("",!0)]),e.dataLoaded?(l(),h("view",bt,[xt,t("view",kt,[t("view",$t,[R(t("input",{class:"search-input",type:"text",placeholder:"\u8F93\u5165\u4F60\u60F3\u8981\u7684\u5185\u5BB9","onUpdate:modelValue":s[4]||(s[4]=c=>D(inputValue)?inputValue.value=c:null)},null,512),[[J,e.inputValue]])]),t("view",Ct,[t("img",{src:e.imgs.search,onClick:s[5]||(s[5]=c=>e.requestSearch())},null,8,It)])]),t("view",Tt,[t("view",St,[t("text",Lt,"\u641C\u7D22\u5269\u4F59\u6B21\u6570\uFF1A"+d(e.remain_credit),1)]),t("view",{class:"topup",onClick:s[6]||(s[6]=(...c)=>e.handleTopup&&e.handleTopup(...c))},[t("img",{src:e.imgs.pay},null,8,Pt),t("text",qt,d(e.payTitle),1)])]),t("view",Et,[t("img",{src:e.imgs.line,mode:"widthFix"},null,8,At)])])):g("",!0),(l(!0),h(I,null,T(e.role_stats,c=>(l(),h("view",Vt,[t("view",Wt,[t("text",null,d(c.role),1)]),t("view",Ft,[(l(!0),h(I,null,T(c.fragments,u=>(l(),h("view",{class:j(u.has_discovered?"item-box discovered":"item-box"),id:"item{{item.id}}"},[u.has_discovered==!0?(l(),y(a,{key:0},{default:m(()=>[t("text",{animation:"{{animate[item.id]}}",onClick:k=>e.handlePieceTap(u.id),"data-cid":"item.id"},d(u.display_label),9,Rt)]),_:2},1024)):(l(),y(a,{key:1},{default:m(()=>[t("text",{onClick:k=>e.handleUnlockedPieceTap(u.id,u.credit_to_unlock)},d(u.display_label),9,Ut)]),_:2},1024))],2))),256))]),t("view",Bt,[t("img",{src:e.imgs.line,mode:"widthFix"},null,8,zt)])]))),256)),Mt]),_:1},8,["spinning","delay"])])}}});const Jt={data(){return{img:"https://assets.storiesmatter.cn/map.png",olddistance:"",newdistance:"",diffdistance:"",oldscaleA:1,Scale:1,baseHeight:"",baseWidth:"",width:"",height:"",px2rpx:2,windowWidth:375}}},Dt={class:"container"},jt=["src"];function Gt(i,e,s,n,o,a){const r=w("scroll-view");return l(),h("view",Dt,[f(r,{"scroll-y":"true","scroll-x":"true",class:"FilePath",bindtouchmove:"scroll",bindtouchstart:"scroll",bindtouchend:"endTou"},{default:m(()=>[t("img",{src:o.img,style:{width:"{{width}}rpx",height:"{{height}}rpx"},bindtouchmove:"touch",mode:"scaleToFill",bindload:"imageLoad"},null,8,jt)]),_:1})])}var Ht=L(Jt,[["render",Gt]]);const Zt={data(){return{search_text:"",content_type:1,display_id:"",role:"",comment:"",text:"",image:"",pictures:[""],imageSize:{},px2px:2,windowWidth:375,src:"",curTime:"00:00",endTime:"00:00",reCurTime:"",reEndTime:"",playurl:"",status:"",cdCls:"pause",currentDot:0,isplay:!1,timer:"",currentFragmentId:87,discoveredList:[],currentPieceIndex:0,last:!1,imgs:{shortLine:"https://assets.storiesmatter.cn/shortline.png",eye:"https://assets.storiesmatter.cn/eye.png",play:"https://assets.storiesmatter.cn/play1.png",pause:"https://assets.storiesmatter.cn/pause1.png"},imgWidth:375}},async mounted(){console.log("imgWidth",this.imgWidth),console.log(this.$route.query),this.imgWidth=(document.documentElement.clientWidth||document.body.clientWidth)-20,console.log("imgWidth",this.imgWidth),S.isEmpty(this.$route.query)||(this.discoveredList=this.$route.query.discoveredList,this.currentPieceIndex=this.$route.query.index),this.gotoPiece()},methods:{gotoMap(){},async requestFragment(){this.$toast.open({message:"\u6B63\u5728\u52A0\u8F7D...",duration:2e3,dismissible:!1});const e=await new b({}).fragments(this.currentFragmentId);e!=null&&(this.search_text=e.search_text,this.content_type=e.content_type,this.role=e.role_name,this.display_id=e.display_id,this.comment=e.comment,this.text=e.text,this.playurl=e.audio,this.image=e.image,this.pictures.push(e.image),this.playurl!=null&&this.content_type==3),this.$toast.clear()},gotoPiece(){this.onUnloadAudio(),this.currentFragmentId=this.discoveredList[this.currentPieceIndex],parseInt(this.currentPieceIndex)+1==this.discoveredList.length?this.last=!0:this.last=!1,console.log("this.currentFragmentId",this.currentFragmentId),this.currentFragmentId!=null&&(this.pictures=[],this.imageSize=[],this.requestFragment())},previous(){this.currentPieceIndex<=0||(this.currentPieceIndex--,this.gotoPiece())},next(){parseInt(this.currentPieceIndex)+1>=this.discoveredList.length||(this.currentPieceIndex++,this.gotoPiece())},onUnloadAudio(){clearInterval(this.timer)},onUnload(){this.onUnloadAudio()}}},Kt={class:"container"},Qt=t("view",{style:{height:"20px"}},null,-1),Xt={class:"choose_character"},Yt={class:"column"},es=["src"],ts=t("view",{style:{width:"20px"}},null,-1),ss={class:"aimg"},is=["src"],os={class:"userinfobtns"},ns={class:"column"},as={class:"btn"},rs={class:"btn"},cs={class:"btn"},ls={class:"wrap"},ds=["src"],us={key:1,class:"sliderCont"},hs=["src"],ps={key:2,class:"message"},ms=t("view",{style:{height:"100px"}},null,-1),gs={class:"bottom"},_s={class:"column"},fs=t("text",{decode:"{{true}}"}," \u4E0A\u4E00\u6761\u53EF\u7528\u788E\u7247 ",-1),ys=[fs],ws=t("text",{decode:"{{true}}"},"\u4E0A\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),vs=[ws],bs=t("text",{decode:"{{true}}"},"\u4E0B\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),xs=[bs],ks=t("text",{decode:"{{true}}"},"\u4E0B\u4E00\u6761\u53EF\u7528\u788E\u7247",-1),$s=[ks];function Cs(i,e,s,n,o,a){const r=w("block");return l(),h("view",Kt,[Qt,t("view",Xt,[t("view",Yt,[t("img",{style:{width:"40px",height:"20px"},src:o.imgs.eye},null,8,es),ts,t("text",null,d(o.search_text),1)]),t("view",ss,[t("img",{src:o.imgs.shortLine,mode:"widthFix"},null,8,is)])]),t("view",os,[t("view",ns,[t("view",as,[t("text",null,d(o.display_id),1)]),t("view",rs,[t("text",null,d(o.role),1)]),t("view",cs,[t("text",null,d(o.comment),1)])])]),o.content_type==2?(l(),h("view",{key:0,class:"fragment-img",onClick:e[0]||(e[0]=(...c)=>a.gotoMap&&a.gotoMap(...c))},[t("view",ls,[t("img",{src:o.pictures[0],style:G({width:o.imgWidth+"px"}),mode:"scaleToFill"},null,12,ds)])])):g("",!0),o.content_type==3?(l(),h("view",us,[t("audio",{src:o.playurl,controls:"controls",class:"aaudio"},null,8,hs)])):g("",!0),o.content_type==1?(l(),h("text",ps,d(o.text),1)):g("",!0),ms,t("view",gs,[t("view",_s,[o.currentPieceIndex==0?(l(),y(r,{key:0},{default:m(()=>[t("view",{class:"btn btn1",onClick:e[1]||(e[1]=(...c)=>a.previous&&a.previous(...c))},ys)]),_:1})):(l(),y(r,{key:1},{default:m(()=>[t("view",{class:"btn",onClick:e[2]||(e[2]=(...c)=>a.previous&&a.previous(...c))},vs)]),_:1})),o.last==!0?(l(),y(r,{key:2},{default:m(()=>[t("view",{class:"btn btn1",onClick:e[3]||(e[3]=(...c)=>a.next&&a.next(...c))},xs)]),_:1})):(l(),y(r,{key:3},{default:m(()=>[t("view",{class:"btn",onClick:e[4]||(e[4]=(...c)=>a.next&&a.next(...c))},$s)]),_:1}))])])])}var Is=L(Zt,[["render",Cs]]);const Ts={components:{},data(){return{pickedId:"",list:[],currentid:"1",position:"left",checked:!1,disabled:!1,pictures:["https://assets.storiesmatter.cn/rewarded-video-ad.png"],imageSize:{},px2rpx:2,windowWidth:375,videoAd:null,form:{message:"This is a sample message",type:"info",duration:1e4,dismissible:!0,queue:!1,position:"bottom-right"}}},onLoad(i){i.type!=null&&(this.type=i.type)},mounted(){this.greet()},computed:{},methods:{greet:async function(i){p.loading(null,this);const s=await new b({}).pricing();s==null||(this.list=s.results,W.set("pricing",s.results)),p.loaded(this)},redirect_url(i){wx.navigateTo({url:`/pages/categories/child?id=${i}&type=${this.type}`})},handleFruitChange({detail:i={}}){this.current=i.value,this.$apply()},handleRadio(i,e){this.checked=e;const s=this.list[e];this.currentid=s.id,this.$apply()},radioChange({detail:i={}}){this.currentid=i.value,this.$apply()},async handlePay(){console.log("sssss"),p.loading(null,this),await new b({}).orders(1,1);const e=await q.Post("topics/1/orders/",{pricing_id:this.currentid});e==null||(console.log(e),e.status=="ok"&&wx.requestPayment({timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign,success:function(s){console.log("PAID!!"),wx.navigateBack({delta:1})},fail:function(s){console.log("\u652F\u4ED8\u5931\u6557")},complete:function(s){console.log("\u652F\u4ED8\u5B8C\u6210")}})),p.loaded()},async handlePay1(){console.log("handlePay1");const i=this;typeof WeixinJSBridge=="undefined"?(console.log("WeixinJSBridge undefined"),document.addEventListener?(console.log("2"),document.addEventListener("WeixinJSBridgeReady",i.onBridgeReady,!1)):document.attachEvent&&(console.log("3"),document.attachEvent("WeixinJSBridgeReady",i.onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",i.onBridgeReady))):(console.log("WeixinJSBridge is defined"),this.onBridgeReady()),this.onBridgeReady()},onBridgeReady(){console.log("4");const i={status:"ok",timeStamp:"1646561422",nonceStr:"LAHJZegDLsrSeSCj",package:"prepay_id=wx061810222880504829a99d9fb1c05d0000",paySign:"32B67F63F8EE7BB889DB3DBECEC22760"},{appId:e="wx1f692d7b9b57066d",timeStamp:s,nonceStr:n,paySign:o}=i,a=i.package,r="MD5";WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e,timeStamp:s,nonceStr:n,package:a,signType:r,paySign:o},function(u){console.log("res",u),u.err_msg=="get_brand_wcpay_request:ok"?console.log("\u652F\u4ED8\u6210\u529F"):console.log("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8")}),new b({}).orders(1).then(u=>{if(!S.isEmpty(u)&&u.status==="ok"){const{appId:k="wx1f692d7b9b57066d",timeStamp:B,nonceStr:E,packageStr:z,paySign:M}=u,O="MD5";console.log("nonceStr",E),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:k,timeStamp:B,nonceStr:E,package:z,signType:O,paySign:M},function(A){console.log("res",A),A.err_msg=="get_brand_wcpay_request:ok"?console.log("\u652F\u4ED8\u6210\u529F"):console.log("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8")})}})},imageLoad(i){const e=i.detail.width*this.px2rpx,s=i.detail.height*this.px2rpx,n=e/s;let o=750,a;e>=o?a=o/n:(o=e,a=s);const r=this.imageSize;r[i.target.dataset.index]={width:o,height:a},this.imageSize=r,this.$apply()},gotoMap(){const i=this.pictures[0]+"?"+Math.random()/9999;wx.previewImage({current:i,urls:[i],success:function(e){},fail:function(e){},complete:function(e){}})},loadAds(){this.videoAd?this.videoAd.show().catch(()=>{this.videoAd.load().then(()=>{this.videoAd.show()}).catch(i=>{console.log("\u6FC0\u52B1\u89C6\u9891 \u5E7F\u544A\u663E\u793A\u5931\u8D25")})}):wx.showModal({title:"\u8B66\u544A",content:"\u53EF\u89C2\u770B\u6FC0\u52B1\u5F0F\u89C6\u9891\u5E7F\u544A\u7684\u6B21\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C \u8BF7\u7A0D\u540E\u91CD\u8BD5",showCancel:!1,success:function(i){}})}},async requestPricing(){p.loading("\u52A0\u8F7D\u4E2D...");const i=await q.Get("topics/1/pricing/");i==null||(this.list=i.results,W.set("pricing",i.results),this.$apply()),p.loaded()},async requestCredit(){const i=await q.Get("topics/1/ads-credit/");i!=null&&wx.showModal({title:"",content:i.added_credit+"\u6B21\u641C\u7D22\u6B21\u6570\u5DF2\u5230\u8D26",showCancel:!1,success:function(e){}})}},Ss={class:"container"},Ls=t("article",null,null,-1),Ps=t("view",{class:"choose_character"},[t("view",{class:"column"},[t("text",{class:"title"},"\u8D2D\u4E70\u641C\u7D22\u6B21\u6570")]),t("view",{class:"img"},[t("image",{src:"https://assets.storiesmatter.cn/shortline.png",mode:"widthFix"})])],-1),qs={class:"statement-list"},Es={class:"cell"},As=["value"],Vs=t("p",null,null,-1),Ws=t("view",{class:"pay"},[t("text",{class:"svg-demo-text"},"\u5FAE\u4FE1\u652F\u4ED8")],-1),Fs=[Ws];function Rs(i,e,s,n,o,a){const r=w("toast"),c=w("repeat");return l(),h("view",Ss,[t("div",null,[Ls,f(r,{position:"ne"})]),Ps,t("view",qs,[t("div",null," 1Picked : "+d(o.pickedId),1),(l(!0),h(I,null,T(o.list,u=>(l(),y(c,{key:i.index,index:"index",item:"item"},{default:m(()=>[t("view",Es,[R(t("input",{class:"statement-list-radio",type:"radio",id:"{{item.credit}}",value:u.id,"onUpdate:modelValue":e[0]||(e[0]=k=>o.pickedId=k)},null,8,As),[[H,o.pickedId]]),t("text",null,d(i.index)+" "+d(u.credit)+"\u6B21\u641C\u7D22 \xA5"+d(u.price),1),Vs])]),_:2},1024))),128))]),t("view",{class:"pay-container",onClick:e[1]||(e[1]=(...u)=>a.handlePay1&&a.handlePay1(...u))},Fs)])}var Us=L(Ts,[["render",Rs]]);const Bs=Z({history:K("/present-vue/"),routes:[{path:"/home",name:"home",component:Nt},{path:"/character",name:"character",component:Je},{path:"/about",name:"about",component:()=>ce(()=>import("./AboutView.ed65a9e5.js"),["assets/AboutView.ed65a9e5.js","assets/AboutView.ab071ea6.css","assets/vendor.c37ff122.js"])},{path:"/piece",component:Is},{path:"/map",component:Ht},{path:"/topup",component:Us}]});const zs=Q({state(){return{count:0}},mutations:{increment(i){i.count++}},modules:{toast:X({dismissInterval:8e3})}}),x=Y(ne);x.use(Bs);x.use(zs);x.use(ee,{position:"top"});x.use(te);x.use(se);x.mount("#app");export{L as _};
